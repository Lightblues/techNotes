
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="O'ver curious">
      
      
        <meta name="author" content="Easonshi">
      
      
        <link rel="canonical" href="https://lightblues.github.io/techNotes/code/JavaScript/node-js-note/">
      
      
        <link rel="prev" href="../jQuery-note/">
      
      
        <link rel="next" href="../../../stat/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Node.js - techNotes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nodejs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="techNotes" class="md-header__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            techNotes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Node.js
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lightblues/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lightblues/techNotes
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../CS/git-note/" class="md-tabs__link">
          
  
  Code

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../stat/" class="md-tabs__link">
          
  
  Stat

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Linux/Linux/" class="md-tabs__link">
          
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../os/EFI/" class="md-tabs__link">
          
  
  OS

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../NLP/Lexicon-%E8%AF%8D%E6%B1%87%E5%A2%9E%E5%BC%BA/" class="md-tabs__link">
          
  
  NLP

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://blog.easonsi.site" class="md-tabs__link">
        
  
    
  
  ğŸ”—Blog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="techNotes" class="md-nav__button md-logo" aria-label="techNotes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    techNotes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lightblues/techNotes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lightblues/techNotes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    CS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            CS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CS/git-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/Python-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    è¯¾ç¨‹ç¬”è®°
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    JavaScripe
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            JavaScripe
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../js-mindmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mindmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../js-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    js note
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jQuery-note/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jQuery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Node.js
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Node.js
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nodejs" class="md-nav__link">
    <span class="md-ellipsis">
      Node.js
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node.js">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ¨¡å—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬æ¨¡å—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web å¼€å‘
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Stat
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Stat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    é«˜ç­‰ç»Ÿè®¡å­¦ä¹ 
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            é«˜ç­‰ç»Ÿè®¡å­¦ä¹ 
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/ASL-mindmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL mindmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/ASL-note1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/ASL-note2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/ASL-note3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/ASL-note4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ASL4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ç®—æ³•å¯¼è®º
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            ç®—æ³•å¯¼è®º
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/Algo-MinCut-2SAT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/Algo-prob-Markov-Chebyshev-Hoeffding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ¦‚ç‡åŸºç¡€
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/Algo-computation-%E8%AE%A1%E7%AE%97%E7%90%86%E8%AE%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    è®¡ç®—ç†è®º
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/Algo-graph-Adjacency-Laplacian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å›¾ç›¸å…³, Laplacian
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/Algo-differential-privacy-%E5%B7%AE%E5%88%86%E9%9A%90%E7%A7%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å·®åˆ†éšç§
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../stat/optimization-%E5%87%B8%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å‡¸ä¼˜åŒ–
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/tutor-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å®éªŒç¯å¢ƒç›¸å…³
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Linux-maintain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ç³»ç»Ÿç»´æŠ¤
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/Linux-configure-make-install-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ç¼–è¯‘å®‰è£…è½¯ä»¶
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            OS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/EFI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EFI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OSs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            OSs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/macOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/macOS-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOS-intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/macOS-softwares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOS è½¯ä»¶åˆ—è¡¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/Hackintosh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hackintosh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/Arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/CentOS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CentOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/Ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/Windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    softwares
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            softwares
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../os/vscode-markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VSCode Markdown
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NLP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            NLP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../NLP/Lexicon-%E8%AF%8D%E6%B1%87%E5%A2%9E%E5%BC%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lexicon è¯æ±‡å¢å¼º
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../NLP/Prompt-%E6%8F%90%E7%A4%BA%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompt æç¤ºè¯­è¨€æ¨¡å‹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../NLP/ABSA-Sentiment-Analysis-%E5%9F%BA%E4%BA%8E%E6%96%B9%E9%9D%A2%E7%9A%84%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ABSA
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://blog.easonsi.site" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ğŸ”—Blog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nodejs" class="md-nav__link">
    <span class="md-ellipsis">
      Node.js
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Node.js">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      æ¨¡å—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬æ¨¡å—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      Web å¼€å‘
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Node.js</h1>

<h2 id="nodejs">Node.js<a class="headerlink" href="#nodejs" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>ä¸‹é¢çš„ä¸»ä½“æ˜¯å»–é›ªå³°æ•™ç¨‹çš„ç¬”è®°çš„ä¸€éƒ¨åˆ†</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>å¦‚ä½•è¿è¡Œ?<ul>
<li>ç›´æ¥ node. <code>node app.js</code></li>
<li>npm <code>npm start</code>. éœ€è¦åœ¨ <code>package.json</code> ä¸­çš„ scripts å®šä¹‰å¯¹åº”çš„ start å‘½ä»¤ (ä¹Ÿæ˜¯ node)</li>
<li>VSCode ä¸­è¿è¡Œ, æˆ–é…ç½® debug</li>
</ul>
</li>
<li>koa<ul>
<li>koa middleware<ul>
<li><code>app.use(async (ctx, next) =&gt; {}</code> (æ¯ä¸ªasyncå‡½æ•°æ˜¯ middleware)</li>
<li>å‚æ•°<code>ctx</code>æ˜¯ç”±koaä¼ å…¥çš„å°è£…äº†requestå’Œresponseçš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒè®¿é—®requestå’Œresponseï¼Œ<code>next</code>æ˜¯koaä¼ å…¥çš„å°†è¦å¤„ç†çš„ä¸‹ä¸€ä¸ªå¼‚æ­¥å‡½æ•°</li>
</ul>
</li>
<li><code>koa-router</code> å¤„ç† URL<ul>
<li>ä½¿ç”¨<code>router.get('/path', async fn)</code>æ¥æ³¨å†Œä¸€ä¸ªGETè¯·æ±‚ã€‚</li>
<li>å¯ä»¥åœ¨è¯·æ±‚è·¯å¾„ä¸­ä½¿ç”¨å¸¦å˜é‡çš„<code>/hello/:name</code>ï¼Œå˜é‡å¯ä»¥é€šè¿‡<code>ctx.params.name</code>è®¿é—®ã€‚</li>
</ul>
</li>
<li><code>koa-bodyparser</code> è§£æ body<ul>
<li><code>app.use(bodyParser());</code></li>
<li>è§£æå‚æ•°ï¼ŒæŠŠè§£æåçš„å‚æ•°ç»‘å®šåˆ°<code>ctx.request.body</code>ä¸­</li>
</ul>
</li>
<li>Middleware<ul>
<li>ä»£ç é‡æ„. ä¾‹å¦‚å¯¹äº URLå¤„ç†çš„ä»£ç æ”¾åœ¨åŒä¸€ä¸ª controllers æ–‡ä»¶å¤¹ä¸­, ç”¨ä¸“é—¨å†™ä¸€ä¸ªå‡½æ•°æ‰«æ<code>controllers</code>ç›®å½•å’Œåˆ›å»º<code>router</code></li>
</ul>
</li>
</ul>
</li>
<li>Nunjucks: æ¨¡æ¿å¼•æ“<ul>
<li>ä½œç”¨: ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰, æ ¼å¼åŒ–, if, for ç­‰é€»è¾‘</li>
<li>å¯¹äº Python ä¸­ jinja2 çš„ js å®ç°</li>
<li>ä½¿ç”¨å¾ˆæ–¹ä¾¿: <code>var s = env.render('hello.html', { name: 'Tom' });</code></li>
<li>block, ç»§æ‰¿ <code>extends</code></li>
</ul>
</li>
<li>mysql<ul>
<li>sequelize, mysql2 åŒ…</li>
<li>åˆ›å»º sequelize å¯¹è±¡å®ä¾‹, ç„¶åå®šä¹‰æ¨¡å‹ (æ•°æ®åº“è¡¨)</li>
<li>æ“ä½œ<ul>
<li><code>create</code> æ’å…¥æ•°æ®</li>
<li><code>findAll</code> æŸ¥è¯¢<ul>
<li>å¯¹æŸ¥è¯¢åˆ°çš„å®ä¾‹è°ƒç”¨ <code>save, destory</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>mocha: å•å…ƒæµ‹è¯•<ul>
<li>å¦‚ä½•æ‰§è¡Œæµ‹è¯•?<ul>
<li>æ–¹æ³•ä¸€ <code>node_modules\mocha\bin\mocha</code></li>
<li>æ–¹æ³•äºŒï¼Œåœ¨ <code>package.json</code> ä¸­æ·»åŠ  scripts <code>"test": "mocha"</code>, ç„¶å <code>npm test</code> å³å¯</li>
<li>æ–¹æ³•ä¸‰ï¼Œé…ç½® VS Code, <code>.vscode/launch.json</code>, å®šä¹‰ <code>"program": "${workspaceRoot}/node_modules/mocha/bin/mocha"</code> ä»¥åŠ <code>"type": "node",</code> â€”â€” å…¶å®å°±æ˜¯è¿è¡Œ <code>node node_modules/mocha/bin/mocha</code></li>
</ul>
</li>
<li>assert åŒ…: <code>const assert = require('assert');</code></li>
<li>å¦‚æœè¦æµ‹è¯•åŒæ­¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¼ å…¥æ— å‚æ•°å‡½æ•°å³å¯<ul>
<li><code>it(' description', function () {}</code></li>
<li>ç„¶ååœ¨å…¶ä¸­ assert åˆ¤æ–­å³å¯</li>
</ul>
</li>
<li>å¦‚æœè¦æµ‹è¯•å¼‚æ­¥å‡½æ•°ï¼Œæˆ‘ä»¬è¦ä¼ å…¥çš„å‡½æ•°éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œé€šå¸¸å‘½åä¸º<code>done</code><ul>
<li><code>it(' description', function (done) {}</code></li>
<li>ç„¶ååœ¨å…¶ä¸­è¿è¡Œä»£æµ‹è¯•çš„å‡½æ•° f</li>
<li>æ‰‹åŠ¨è°ƒç”¨<code>done()</code>è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼Œ<code>done(err)</code>è¡¨ç¤ºæµ‹è¯•å‡ºé”™</li>
</ul>
</li>
<li>å¯¹äº async å‡½æ•°, æ›´æ–¹ä¾¿çš„æ˜¯ç›´æ¥å°†å…¶è½¬åŒ–ä¸ºåŒæ­¥å‡½æ•°æµ‹è¯•<ul>
<li>ä¾‹å¦‚, ä¼ å…¥ <code>async () =&gt; { assert.strictEqual(await f(), groundTruth) }</code></li>
</ul>
</li>
<li>Http æµ‹è¯•: <code>supertest</code> åŒ…<ul>
<li><code>request = require('supertest')</code></li>
<li>ä½¿ç”¨ <code>let res = await request(server).get('/');</code> æ„é€ ä¸€ä¸ªGETè¯·æ±‚ï¼Œå‘é€ç»™koaçš„åº”ç”¨ï¼Œç„¶åè·å¾—å“åº”</li>
<li>å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥å“åº”å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œ<code>res.body</code>ï¼Œè¿˜å¯ä»¥åˆ©ç”¨<code>supertest</code>æä¾›çš„<code>expect()</code>æ›´æ–¹ä¾¿åœ°æ–­è¨€å“åº”çš„HTTPä»£ç ã€è¿”å›å†…å®¹å’ŒHTTPå¤´ã€‚æ–­è¨€HTTPå¤´æ—¶å¯ç”¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</li>
</ul>
</li>
</ul>
</li>
<li>WebSocket<ul>
<li>ws åè®®</li>
<li>koa å’Œ ws åŒ…å¯ä»¥å…±ç”¨ä¸€ä¸ªç«¯å£, æ¯”å¦‚é»˜è®¤çš„ 3000. å› ä¸º koa å®é™…ä¸Šè°ƒç”¨ Nodeæ ‡å‡†httpæ¨¡å—åˆ›å»ºçš„ http.Server ç›‘å¬çš„, åªæ˜¯æŠŠå“åº”å‡½æ•°æ³¨å†Œåˆ°äº†å…¶ä¸­, ws ä¹Ÿä¸€æ ·, å› æ­¤å¯ä»¥ç”¨ä¸€ä¸ªç«¯å£, æ ¹æ®åè®®ä¸åŒåˆ†åˆ«ç”± koa å’Œ ws å¤„ç†.</li>
<li>å¦‚ä½•è¯†åˆ«ç”¨æˆ·èº«ä»½?<ul>
<li>æ€»ä½“è€Œè¨€, cookie æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç›¸äº’é…åˆçš„è¿‡ç¨‹. æœåŠ¡å™¨åˆ›å»º cookie, æµè§ˆå™¨ä¿å­˜å¹¶åœ¨ä¹‹åçš„è¯·æ±‚ä¸­é™„åŠ  cookie; è‹¥è¦å»ºç«‹ ws é“¾æ¥ä¹Ÿç”¨ cookie å³å¯.</li>
</ul>
</li>
<li>æ¡ˆä¾‹: èŠå¤©å®¤. æœåŠ¡å™¨ç»´æŠ¤ä¸€ç»„ ws è¿æ¥, æ¯å½“æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ä¹‹å, å¹¿æ’­åˆ°æ‰€æœ‰è¿æ¥.</li>
</ul>
</li>
<li>REST<ul>
<li>è·å–èµ„æºç”¨ GET, æ–°å»ºã€æ›´æ–°ã€åˆ é™¤ åˆ†åˆ«ç”¨ POST, PUT, DELETE è¯·æ±‚, å†…å®¹æ”¾åœ¨ body ä¸­ (<code>Content-Type</code> ä¸º <code>application/json</code>)</li>
</ul>
</li>
</ul>
</div>
<ul>
<li>å› ä¸ºJavaScriptæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæ ¹æœ¬ä¸èƒ½è¿›è¡ŒåŒæ­¥IOæ“ä½œï¼Œæ‰€ä»¥ï¼ŒJavaScriptçš„è¿™ä¸€â€œç¼ºé™·â€å¯¼è‡´äº†å®ƒåªèƒ½ä½¿ç”¨å¼‚æ­¥IOã€‚</li>
<li>ä¼˜åŠ¿<ul>
<li>æœ€å¤§çš„ä¼˜åŠ¿æ˜¯å€ŸåŠ©JavaScriptå¤©ç”Ÿçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶åŠ V8é«˜æ€§èƒ½å¼•æ“ï¼Œä½¿ç¼–å†™é«˜æ€§èƒ½WebæœåŠ¡è½»è€Œæ˜“ä¸¾ã€‚</li>
<li>åœ¨Nodeç¯å¢ƒä¸‹ï¼Œé€šè¿‡æ¨¡å—åŒ–çš„JavaScriptä»£ç ï¼ŒåŠ ä¸Šå‡½æ•°å¼ç¼–ç¨‹ï¼Œå¹¶ä¸”æ— éœ€è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨æœ€æ–°çš„ECMAScript 6æ ‡å‡†ï¼Œå¯ä»¥å®Œå…¨æ»¡è¶³å·¥ç¨‹ä¸Šçš„éœ€æ±‚ã€‚</li>
</ul>
</li>
<li><a href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a></li>
<li>npm<ul>
<li>npmå…¶å®æ˜¯Node.jsçš„åŒ…ç®¡ç†å·¥å…·ï¼ˆpackage managerï¼‰</li>
</ul>
</li>
<li>Node<ul>
<li>å‘½ä»¤è¡Œæ¨¡å¼å’ŒNodeäº¤äº’æ¨¡å¼</li>
</ul>
</li>
<li><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1099503821472096">ä½¿ç”¨ VSCode è°ƒè¯•</a></li>
</ul>
<h3 id="_1">æ¨¡å—<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cm">/* hallo.js */</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">greet</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;, &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">greet</span><span class="p">;</span>

<span class="cm">/* main.js */</span>
<span class="c1">// å¼•å…¥helloæ¨¡å—:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">greet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./hello&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Michael&#39;</span><span class="p">;</span>

<span class="nx">greet</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// Hello, Michael!</span>
</code></pre></div>
<ul>
<li>åœ¨ä½¿ç”¨<code>require()</code>å¼•å…¥æ¨¡å—çš„æ—¶å€™ï¼Œè¯·æ³¨æ„æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ã€‚ã€ä¾‹å¦‚ï¼Œ<code>./hello.js</code>ã€‘</li>
<li>å¦‚æœåªå†™æ¨¡å—åã€å¦‚ <code>hello.js</code>ã€‘ï¼Œåˆ™Nodeä¼šä¾æ¬¡åœ¨ <strong>å†…ç½®æ¨¡å—ã€å…¨å±€æ¨¡å—å’Œå½“å‰æ¨¡å—</strong> ä¸‹æŸ¥æ‰¾hello.jsã€‚</li>
</ul>
<h4 id="commonjs">CommonJS è§„èŒƒ<a class="headerlink" href="#commonjs" title="Permanent link">&para;</a></h4>
<ul>
<li>è¿™ç§æ¨¡å—åŠ è½½æœºåˆ¶è¢«ç§°ä¸ºCommonJSè§„èŒƒã€‚åœ¨è¿™ä¸ªè§„èŒƒä¸‹ï¼Œæ¯ä¸ª<code>.js</code>æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒä»¬å†…éƒ¨å„è‡ªä½¿ç”¨çš„å˜é‡åå’Œå‡½æ•°åéƒ½äº’ä¸å†²çªï¼Œä¾‹å¦‚ï¼Œ<code>hello.js</code> å’Œ <code>main.js</code> éƒ½ç”³æ˜äº†å…¨å±€å˜é‡ <code>var s = 'xxx'</code>ï¼Œä½†äº’ä¸å½±å“ã€‚</li>
<li>ä¸€ä¸ªæ¨¡å—æƒ³è¦å¯¹å¤–æš´éœ²å˜é‡ï¼ˆå‡½æ•°ä¹Ÿæ˜¯å˜é‡ï¼‰ï¼Œå¯ä»¥ç”¨ <code>module.exports = variable;</code>ï¼Œä¸€ä¸ªæ¨¡å—è¦å¼•ç”¨å…¶ä»–æ¨¡å—æš´éœ²çš„å˜é‡ï¼Œç”¨ <code>var ref = require('module_name');</code> å°±æ‹¿åˆ°äº†å¼•ç”¨æ¨¡å—çš„å˜é‡ã€‚</li>
</ul>
<h4 id="_2">æ¨¡å—å®ç°æœºåˆ¶<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<ul>
<li>(æµè§ˆå™¨ä¸­) JavaScriptè¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰ä¸€ç§æ¨¡å—æœºåˆ¶æ¥ä¿è¯ä¸åŒæ¨¡å—å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å˜é‡åã€‚</li>
<li>å…¶å®è¦å®ç°â€œæ¨¡å—â€è¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸éœ€è¦è¯­æ³•å±‚é¢çš„æ”¯æŒã€‚Node.jsä¹Ÿå¹¶ä¸ä¼šå¢åŠ ä»»ä½•JavaScriptè¯­æ³•ã€‚å®ç°â€œæ¨¡å—â€åŠŸèƒ½çš„å¥¥å¦™å°±åœ¨äºJavaScriptæ˜¯ä¸€ç§å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ”¯æŒé—­åŒ…ã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸€æ®µJavaScriptä»£ç ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£…èµ·æ¥ï¼Œè¿™æ®µä»£ç çš„æ‰€æœ‰â€œå…¨å±€â€å˜é‡å°±å˜æˆäº†å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ã€‚</li>
<li>æ¨¡å—çš„è¾“å‡º<code>module.exports</code>æ€ä¹ˆå®ç°ï¼Ÿ</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// å‡†å¤‡moduleå¯¹è±¡:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">exports</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">load</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">module</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è¯»å–çš„hello.jsä»£ç :</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">greet</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello, &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;!&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">greet</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// hello.jsä»£ç ç»“æŸ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">exported</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">load</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
<span class="c1">// ä¿å­˜module:</span>
<span class="nx">save</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span><span class="w"> </span><span class="nx">exported</span><span class="p">);</span>
</code></pre></div>
<h3 id="_3">åŸºæœ¬æ¨¡å—<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>å› ä¸º Node.js æ˜¯è¿è¡Œåœ¨æœåŠ¡åŒºç«¯çš„ JavaScript ç¯å¢ƒï¼ŒæœåŠ¡å™¨ç¨‹åºå’Œæµè§ˆå™¨ç¨‹åºç›¸æ¯”ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ²¡æœ‰æµè§ˆå™¨çš„å®‰å…¨é™åˆ¶äº†ï¼Œè€Œä¸”ï¼ŒæœåŠ¡å™¨ç¨‹åºå¿…é¡»èƒ½æ¥æ”¶ç½‘ç»œè¯·æ±‚ï¼Œè¯»å†™æ–‡ä»¶ï¼Œå¤„ç†äºŒè¿›åˆ¶å†…å®¹ï¼Œæ‰€ä»¥ï¼ŒNode.jså†…ç½®çš„å¸¸ç”¨æ¨¡å—å°±æ˜¯ä¸ºäº†å®ç°åŸºæœ¬çš„æœåŠ¡å™¨åŠŸèƒ½ã€‚è¿™äº›æ¨¡å—åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ˜¯æ— æ³•è¢«æ‰§è¡Œçš„ï¼Œå› ä¸ºå®ƒä»¬çš„åº•å±‚ä»£ç æ˜¯ç”¨C/C++åœ¨Node.jsè¿è¡Œç¯å¢ƒä¸­å®ç°çš„ã€‚</p>
<h4 id="node">Node æ¨¡å—åŸºç¡€<a class="headerlink" href="#node" title="Permanent link">&para;</a></h4>
<ul>
<li>global<ul>
<li>JavaScriptæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå«<code>window</code>å¯¹è±¡ã€‚è€Œåœ¨Node.jsç¯å¢ƒä¸­ï¼Œä¹Ÿæœ‰å”¯ä¸€çš„å…¨å±€å¯¹è±¡ï¼Œå«<code>global</code>ï¼Œè¿™ä¸ªå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä¹Ÿå’Œæµè§ˆå™¨ç¯å¢ƒçš„<code>window</code>ä¸åŒ</li>
<li><code>global.console</code></li>
</ul>
</li>
<li>process<ul>
<li><code>process</code>ä¹Ÿæ˜¯Node.jsæä¾›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒä»£è¡¨å½“å‰Node.jsè¿›ç¨‹ã€‚</li>
<li>JavaScriptç¨‹åºæ˜¯ç”±äº‹ä»¶é©±åŠ¨æ‰§è¡Œçš„å•çº¿ç¨‹æ¨¡å‹ï¼ŒNode.jsä¹Ÿä¸ä¾‹å¤–ã€‚Node.jsä¸æ–­æ‰§è¡Œå“åº”äº‹ä»¶çš„JavaScriptå‡½æ•°ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å“åº”äº‹ä»¶çš„å‡½æ•°å¯ä»¥æ‰§è¡Œæ—¶ï¼ŒNode.jså°±é€€å‡ºäº†ã€‚</li>
<li>å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ä¸‹ä¸€æ¬¡äº‹ä»¶å“åº”ä¸­æ‰§è¡Œä»£ç ï¼Œå¯ä»¥è°ƒç”¨<code>process.nextTick()</code></li>
<li>Node.jsè¿›ç¨‹æœ¬èº«çš„äº‹ä»¶å°±ç”±<code>process</code>å¯¹è±¡æ¥å¤„ç†ã€‚å¦‚æœæˆ‘ä»¬å“åº”<code>exit</code>äº‹ä»¶ï¼Œå¯ä»¥ <code>process.on('exit', function (code) {}</code></li>
</ul>
</li>
<li>åˆ¤æ–­ js æ‰§è¡Œç¯å¢ƒ<ul>
<li>å¸¸ç”¨çš„æ–¹å¼å°±æ˜¯æ ¹æ®æµè§ˆå™¨å’ŒNodeç¯å¢ƒæä¾›çš„å…¨å±€å˜é‡åç§°æ¥åˆ¤æ–­</li>
<li><code>if (typeof(window) === 'undefined')</code> åˆ™æ˜¯ node ç¯å¢ƒ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="nb">global</span><span class="p">.</span><span class="nx">console</span>
<span class="nx">Console</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">log</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">info</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">warn</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">dir</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">timeEnd</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">trace</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="nx">trace</span><span class="p">],</span>
<span class="w">  </span><span class="nx">assert</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">bound</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nx">Console</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">Function</span><span class="o">:</span><span class="w"> </span><span class="nx">Console</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">global</span><span class="p">.</span><span class="nx">process</span><span class="p">;</span>
<span class="kc">true</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">version</span><span class="p">;</span>
<span class="s1">&#39;v5.2.0&#39;</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span><span class="p">;</span>
<span class="s1">&#39;darwin&#39;</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">arch</span><span class="p">;</span>
<span class="s1">&#39;x64&#39;</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">();</span><span class="w"> </span><span class="c1">//è¿”å›å½“å‰å·¥ä½œç›®å½•</span>
<span class="s1">&#39;/Users/michael&#39;</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;/private/tmp&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ‡æ¢å½“å‰å·¥ä½œç›®å½•</span>
<span class="kc">undefined</span>
<span class="o">&gt;</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">();</span>
<span class="s1">&#39;/private/tmp&#39;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// test.js</span>

<span class="c1">// process.nextTick()å°†åœ¨ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ä¸­è°ƒç”¨:</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;nextTick callback!&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;nextTick was set!&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// ç¨‹åºå³å°†é€€å‡ºæ—¶çš„å›è°ƒå‡½æ•°:</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;about to exit with code: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// åˆ¤æ–­JavaScriptæ‰§è¡Œç¯å¢ƒ</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;undefined&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;node.js&#39;</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;browser&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="fs">fs æ¨¡å—<a class="headerlink" href="#fs" title="Permanent link">&para;</a></h4>
<ul>
<li>Node.jså†…ç½®çš„<code>fs</code>æ¨¡å—å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼Œè´Ÿè´£è¯»å†™æ–‡ä»¶ã€‚</li>
<li>å’Œæ‰€æœ‰å…¶å®ƒJavaScriptæ¨¡å—ä¸åŒçš„æ˜¯ï¼Œ<code>fs</code> æ¨¡å—åŒæ—¶æä¾›äº†å¼‚æ­¥å’ŒåŒæ­¥çš„æ–¹æ³•ã€‚</li>
<li>å¼‚æ­¥è¯»å–<ul>
<li><code>fs.readFile('sample.txt', 'utf-8', function (err, data) {})</code></li>
<li>ç¬¬äºŒä¸ªå‚æ•°: æ–‡ä»¶ç¼–ç </li>
<li>å¼‚æ­¥è¯»å–æ—¶ï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå½“æ­£å¸¸è¯»å–æ—¶ï¼Œ<code>err</code>å‚æ•°ä¸º<code>null</code>ï¼Œ<code>data</code>å‚æ•°ä¸ºè¯»å–åˆ°çš„Stringã€‚å½“è¯»å–å‘ç”Ÿé”™è¯¯æ—¶ï¼Œ<code>err</code>å‚æ•°ä»£è¡¨ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œ<code>data</code>ä¸º<code>undefined</code>ã€‚è¿™ä¹Ÿæ˜¯Node.jsæ ‡å‡†çš„å›è°ƒå‡½æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨é”™è¯¯ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨ç»“æœã€‚</li>
<li>å½“è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä¸ä¼ å…¥æ–‡ä»¶ç¼–ç æ—¶ï¼Œå›è°ƒå‡½æ•°çš„<code>data</code>å‚æ•°å°†è¿”å›ä¸€ä¸ª<code>Buffer</code>å¯¹è±¡ã€‚åœ¨Node.jsä¸­ï¼Œ<code>Buffer</code>å¯¹è±¡å°±æ˜¯ä¸€ä¸ªåŒ…å«é›¶ä¸ªæˆ–ä»»æ„ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼ˆæ³¨æ„å’ŒArrayä¸åŒï¼‰ã€‚<ul>
<li>Buffer å¯¹è±¡å¯ä»¥å’Œ String è½¬æ¢,</li>
<li><code>data.toString('utf-8')</code> å’Œ <code>Buffer.from(text, 'utf-8')</code></li>
</ul>
</li>
</ul>
</li>
<li>åŒæ­¥è¯»å–<ul>
<li><code>var data = fs.readFileSync('sample.txt', 'utf-8');</code></li>
<li>ä¸ä¼ å…¥å›è°ƒå‡½æ•°, ç›´æ¥è¿”å›</li>
<li>å¦‚æœåŒæ­¥è¯»å–æ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™éœ€è¦ç”¨<code>try...catch</code>æ•è·è¯¥é”™è¯¯</li>
</ul>
</li>
<li>å†™æ–‡ä»¶<ul>
<li><code>fs.writeFile('output.txt', data, function (err) {})</code></li>
<li><code>writeFile()</code>çš„å‚æ•°ä¾æ¬¡ä¸ºæ–‡ä»¶åã€æ•°æ®å’Œå›è°ƒå‡½æ•°ã€‚å¦‚æœä¼ å…¥çš„æ•°æ®æ˜¯Stringï¼Œé»˜è®¤æŒ‰UTF-8ç¼–ç å†™å…¥æ–‡æœ¬æ–‡ä»¶ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯<code>Buffer</code>ï¼Œåˆ™å†™å…¥çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å›è°ƒå‡½æ•°ç”±äºåªå…³å¿ƒæˆåŠŸä¸å¦ï¼Œå› æ­¤åªéœ€è¦ä¸€ä¸ª<code>err</code>å‚æ•°ã€‚</li>
<li><code>fs.writeFileSync('output.txt', data);</code></li>
</ul>
</li>
<li>stat<ul>
<li>å¦‚æœæˆ‘ä»¬è¦è·å–æ–‡ä»¶å¤§å°ï¼Œåˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>fs.stat()</code>ï¼Œå®ƒè¿”å›ä¸€ä¸ª<code>Stat</code>å¯¹è±¡ï¼Œèƒ½å‘Šè¯‰æˆ‘ä»¬æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†ä¿¡æ¯</li>
<li>å±æ€§:<ul>
<li><code>isFile, isDirectory</code>,</li>
<li><code>size</code></li>
<li><code>birthtime, mtime</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="_4">å¼‚æ­¥è¯»æ–‡ä»¶<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h5>
<p>æŒ‰ç…§JavaScriptçš„æ ‡å‡†ï¼Œå¼‚æ­¥è¯»å–ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;sample.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>å¼‚æ­¥è¯»å–æ—¶ï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå½“æ­£å¸¸è¯»å–æ—¶ï¼Œ<code>err</code>å‚æ•°ä¸º<code>null</code>ï¼Œ<code>data</code>å‚æ•°ä¸ºè¯»å–åˆ°çš„Stringã€‚å½“è¯»å–å‘ç”Ÿé”™è¯¯æ—¶ï¼Œ<code>err</code>å‚æ•°ä»£è¡¨ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œ<code>data</code>ä¸º<code>undefined</code>ã€‚è¿™ä¹Ÿæ˜¯Node.jsæ ‡å‡†çš„å›è°ƒå‡½æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨é”™è¯¯ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨ç»“æœã€‚åé¢æˆ‘ä»¬è¿˜ä¼šç»å¸¸ç¼–å†™è¿™ç§å›è°ƒå‡½æ•°ã€‚</p>
<ul>
<li>å½“è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä¸ä¼ å…¥æ–‡ä»¶ç¼–ç æ—¶ï¼Œå›è°ƒå‡½æ•°çš„<code>data</code>å‚æ•°å°†è¿”å›ä¸€ä¸ª <code>Buffer</code> å¯¹è±¡ã€‚åœ¨Node.jsä¸­ï¼Œ<code>Buffer</code>å¯¹è±¡å°±æ˜¯ä¸€ä¸ªåŒ…å«é›¶ä¸ªæˆ–ä»»æ„ä¸ªå­—èŠ‚çš„ <strong>æ•°ç»„</strong> ï¼ˆæ³¨æ„å’ŒArrayä¸åŒï¼‰ã€‚</li>
<li><code>Buffer</code>å¯¹è±¡å¯ä»¥å’ŒStringä½œè½¬æ¢</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// Buffer -&gt; String</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>

<span class="c1">// String -&gt; Buffer</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
</code></pre></div>
<h5 id="_5">åŒæ­¥è¯»æ–‡ä»¶<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h5>
<ul>
<li>é™¤äº†æ ‡å‡†çš„å¼‚æ­¥è¯»å–æ¨¡å¼å¤–ï¼Œ<code>fs</code>ä¹Ÿæä¾›ç›¸åº”çš„åŒæ­¥è¯»å–å‡½æ•°ã€‚åŒæ­¥è¯»å–çš„å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ª<code>Sync</code>åç¼€ï¼Œå¹¶ä¸”ä¸æ¥æ”¶å›è°ƒå‡½æ•°ï¼Œå‡½æ•°ç›´æ¥è¿”å›ç»“æœã€‚</li>
<li>å¯è§ï¼ŒåŸå¼‚æ­¥è°ƒç”¨çš„å›è°ƒå‡½æ•°çš„<code>data</code>è¢«å‡½æ•°ç›´æ¥è¿”å›ï¼Œå‡½æ•°åéœ€è¦æ”¹ä¸º<code>readFileSync</code>ï¼Œå…¶å®ƒå‚æ•°ä¸å˜ã€‚</li>
<li>å¦‚æœåŒæ­¥è¯»å–æ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™éœ€è¦ç”¨<code>try...catch</code>æ•è·è¯¥é”™è¯¯</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;sample.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å‡ºé”™äº†</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="_6">å¼‚æ­¥è¿˜æ˜¯åŒæ­¥<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h5>
<ul>
<li>åœ¨<code>fs</code>æ¨¡å—ä¸­ï¼Œæä¾›åŒæ­¥æ–¹æ³•æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ã€‚é‚£æˆ‘ä»¬åˆ°åº•æ˜¯åº”è¯¥ç”¨å¼‚æ­¥æ–¹æ³•è¿˜æ˜¯åŒæ­¥æ–¹æ³•å‘¢ï¼Ÿ</li>
<li>ç”±äºNodeç¯å¢ƒæ‰§è¡Œçš„JavaScriptä»£ç æ˜¯æœåŠ¡å™¨ç«¯ä»£ç ï¼Œæ‰€ä»¥ï¼Œç»å¤§éƒ¨åˆ†éœ€è¦åœ¨æœåŠ¡å™¨è¿è¡ŒæœŸåå¤æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„ä»£ç ï¼Œ<strong>å¿…é¡»ä½¿ç”¨å¼‚æ­¥ä»£ç </strong>ï¼Œå¦åˆ™ï¼ŒåŒæ­¥ä»£ç åœ¨æ‰§è¡Œæ—¶æœŸï¼ŒæœåŠ¡å™¨å°†åœæ­¢å“åº”ï¼Œå› ä¸ºJavaScriptåªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚</li>
<li>æœåŠ¡å™¨å¯åŠ¨æ—¶å¦‚æœéœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…ç»“æŸæ—¶éœ€è¦å†™å…¥åˆ°çŠ¶æ€æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥ä»£ç ï¼Œå› ä¸ºè¿™äº›ä»£ç åªåœ¨å¯åŠ¨å’Œç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¸å½±å“æœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ—¶çš„å¼‚æ­¥æ‰§è¡Œã€‚</li>
</ul>
<h4 id="stream">stream æ¨¡å—<a class="headerlink" href="#stream" title="Permanent link">&para;</a></h4>
<ul>
<li><code>stream</code> æ˜¯Node.jsæä¾›çš„åˆä¸€ä¸ªä»…åœ¨æœåŠ¡ç«¯å¯ç”¨çš„æ¨¡å—ï¼Œç›®çš„æ˜¯æ”¯æŒâ€œæµâ€è¿™ç§æ•°æ®ç»“æ„ã€‚</li>
<li>æµçš„ç‰¹ç‚¹æ˜¯æ•°æ®æ˜¯æœ‰åºçš„ï¼Œè€Œä¸”å¿…é¡»ä¾æ¬¡è¯»å–ï¼Œæˆ–è€…ä¾æ¬¡å†™å…¥ï¼Œä¸èƒ½åƒArrayé‚£æ ·éšæœºå®šä½ã€‚</li>
<li>åœ¨Node.jsä¸­ï¼Œæµä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦å“åº”æµçš„äº‹ä»¶å°±å¯ä»¥äº†ï¼š<code>data</code>äº‹ä»¶è¡¨ç¤ºæµçš„æ•°æ®å·²ç»å¯ä»¥è¯»å–äº†ï¼Œ<code>end</code>äº‹ä»¶è¡¨ç¤ºè¿™ä¸ªæµå·²ç»åˆ°æœ«å°¾äº†ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»å–äº†ï¼Œ<code>error</code>äº‹ä»¶è¡¨ç¤ºå‡ºé”™äº†ã€‚<ul>
<li><code>var rs = fs.createReadStream('sample.txt', 'utf-8');</code></li>
<li>è¦æ³¨æ„ï¼Œ<code>data</code>äº‹ä»¶å¯èƒ½ä¼šæœ‰å¤šæ¬¡ï¼Œæ¯æ¬¡ä¼ é€’çš„<code>chunk</code>æ˜¯æµçš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚</li>
</ul>
</li>
<li>å†™å…¥: è¦ä»¥æµçš„å½¢å¼å†™å…¥æ–‡ä»¶ï¼Œåªéœ€è¦ä¸æ–­è°ƒç”¨<code>write()</code>æ–¹æ³• (å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²æˆ– Buffer)ï¼Œæœ€åä»¥<code>end()</code>ç»“æŸ<ul>
<li><code>var ws1 = fs.createWriteStream('output1.txt', 'utf-8');</code></li>
</ul>
</li>
<li>æ‰€æœ‰å¯ä»¥è¯»å–æ•°æ®çš„æµéƒ½ç»§æ‰¿è‡ª<code>stream.Readable</code>ï¼Œæ‰€æœ‰å¯ä»¥å†™å…¥çš„æµéƒ½ç»§æ‰¿è‡ª<code>stream.Writable</code>ã€‚</li>
<li>pipe<ul>
<li>å°±åƒå¯ä»¥æŠŠä¸¤ä¸ªæ°´ç®¡ä¸²æˆä¸€ä¸ªæ›´é•¿çš„æ°´ç®¡ä¸€æ ·ï¼Œä¸¤ä¸ªæµä¹Ÿå¯ä»¥ä¸²èµ·æ¥ã€‚ä¸€ä¸ª<code>Readable</code>æµå’Œä¸€ä¸ª<code>Writable</code>æµä¸²èµ·æ¥åï¼Œæ‰€æœ‰çš„æ•°æ®è‡ªåŠ¨ä»<code>Readable</code>æµè¿›å…¥<code>Writable</code>æµï¼Œè¿™ç§æ“ä½œå«<code>pipe</code>ã€‚</li>
<li>åœ¨Node.jsä¸­ï¼Œ<code>Readable</code>æµæœ‰ä¸€ä¸ª<code>pipe()</code>æ–¹æ³•, å¯ä»¥è¿›è¡Œå¤åˆ¶</li>
<li><code>rs.pipe(ws);</code></li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“<code>Readable</code>æµçš„æ•°æ®è¯»å–å®Œæ¯•ï¼Œ<code>end</code>äº‹ä»¶è§¦å‘åï¼Œå°†è‡ªåŠ¨å…³é—­<code>Writable</code>æµã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›è‡ªåŠ¨å…³é—­<code>Writable</code>æµï¼Œéœ€è¦ä¼ å…¥å‚æ•° <code>readable.pipe(writable, { end: false });</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* ä»æ–‡ä»¶æµè¯»å–æ–‡æœ¬å†…å®¹ */</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="c1">// æ‰“å¼€ä¸€ä¸ªæµ:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&#39;sample.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;DATA:&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">chunk</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;END&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ERROR: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>ä»¥æµçš„å½¢å¼å†™å…¥æ–‡ä»¶</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">ws1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;output1.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;ä½¿ç”¨Streamå†™å…¥æ–‡æœ¬æ•°æ®...\n&#39;</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;END.&#39;</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">ws2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;output2.txt&#39;</span><span class="p">);</span>
<span class="nx">ws2</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;ä½¿ç”¨Streamå†™å…¥äºŒè¿›åˆ¶æ•°æ®...\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">));</span>
<span class="nx">ws2</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;END.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf-8&#39;</span><span class="p">));</span>
<span class="nx">ws2</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
</code></pre></div>
<p>pipe</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">&#39;sample.txt&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;copied.txt&#39;</span><span class="p">);</span>

<span class="nx">rs</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">ws</span><span class="p">);</span>
</code></pre></div>
<h4 id="http">http æ¨¡å—<a class="headerlink" href="#http" title="Permanent link">&para;</a></h4>
<ul>
<li>è¦ç†è§£WebæœåŠ¡å™¨ç¨‹åºçš„å·¥ä½œåŸç†ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è¦å¯¹HTTPåè®®æœ‰åŸºæœ¬çš„äº†è§£ã€‚å¦‚æœä½ å¯¹HTTPåè®®ä¸å¤ªç†Ÿæ‚‰ï¼Œå…ˆçœ‹ä¸€çœ‹ <a href="http://www.liaoxuefeng.com/wiki/1016959663602400/1017804782304672">HTTPåè®®ç®€ä»‹</a>ã€‚</li>
<li>è¦å¼€å‘HTTPæœåŠ¡å™¨ç¨‹åºï¼Œä»å¤´å¤„ç†TCPè¿æ¥ï¼Œè§£æHTTPæ˜¯ä¸ç°å®çš„ã€‚è¿™äº›å·¥ä½œå®é™…ä¸Šå·²ç»ç”±Node.jsè‡ªå¸¦çš„<code>http</code>æ¨¡å—å®Œæˆäº†ã€‚åº”ç”¨ç¨‹åºå¹¶ä¸ç›´æ¥å’ŒHTTPåè®®æ‰“äº¤é“ï¼Œè€Œæ˜¯æ“ä½œ<code>http</code>æ¨¡å—æä¾›çš„<code>request</code>å’Œ<code>response</code>å¯¹è±¡ã€‚<ul>
<li><code>request</code>å¯¹è±¡å°è£…äº†HTTPè¯·æ±‚ï¼Œæˆ‘ä»¬è°ƒç”¨<code>request</code>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°æ‰€æœ‰HTTPè¯·æ±‚çš„ä¿¡æ¯ï¼›</li>
<li><code>response</code>å¯¹è±¡å°è£…äº†HTTPå“åº”ï¼Œæˆ‘ä»¬æ“ä½œ<code>response</code>å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠHTTPå“åº”è¿”å›ç»™æµè§ˆå™¨ã€‚</li>
</ul>
</li>
<li><code>var server = http.createServer(function (request, response) {}</code> (ç›´æ¥å»çœ‹ç¤ºä¾‹ä»£ç )</li>
<li>ç„¶åè®¾ç½®ç›‘å¬ <code>server.listen(8080);</code></li>
<li>å…¶ä»–æ¨¡å—<ul>
<li>è§£æURLéœ€è¦ç”¨åˆ°Node.jsæä¾›çš„<code>url</code>æ¨¡å—ï¼Œå®ƒä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œé€šè¿‡<code>parse()</code> å°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ª<code>Url</code>å¯¹è±¡</li>
<li>å¤„ç†æœ¬åœ°æ–‡ä»¶ç›®å½•éœ€è¦ä½¿ç”¨Node.jsæä¾›çš„<code>path</code>æ¨¡å—ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°æ„é€ ç›®å½•</li>
</ul>
</li>
</ul>
<p>ç”¨Node.jså®ç°ä¸€ä¸ªHTTPæœåŠ¡å™¨ç¨‹åºéå¸¸ç®€å•ã€‚æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•çš„Webç¨‹åº<code>hello.js</code>ï¼Œå®ƒå¯¹äºæ‰€æœ‰è¯·æ±‚ï¼Œéƒ½è¿”å›<code>Hello world!</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">// å¯¼å…¥httpæ¨¡å—:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºhttp serverï¼Œå¹¶ä¼ å…¥å›è°ƒå‡½æ•°:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å›è°ƒå‡½æ•°æ¥æ”¶requestå’Œresponseå¯¹è±¡,</span>
<span class="w">    </span><span class="c1">// è·å¾—HTTPè¯·æ±‚çš„methodå’Œurl:</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// å°†HTTPå“åº”200å†™å…¥response, åŒæ—¶è®¾ç½®Content-Type: text/html:</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
<span class="w">    </span><span class="c1">// å°†HTTPå“åº”çš„HTMLå†…å®¹å†™å…¥response:</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Hello world!&lt;/h1&gt;&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// è®©æœåŠ¡å™¨ç›‘å¬8080ç«¯å£:</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8080</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is running at http://127.0.0.1:8080/&#39;</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>è®©æˆ‘ä»¬ç»§ç»­æ‰©å±•ä¸€ä¸‹ä¸Šé¢çš„Webç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ªç›®å½•ï¼Œç„¶åè®©Webç¨‹åºå˜æˆä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦è§£æ<code>request.url</code>ä¸­çš„è·¯å¾„ï¼Œç„¶ååœ¨æœ¬åœ°æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼ŒæŠŠæ–‡ä»¶å†…å®¹å‘é€å‡ºå»å°±å¯ä»¥äº†ã€‚</li>
<li>è§£æURLéœ€è¦ç”¨åˆ°Node.jsæä¾›çš„<code>url</code>æ¨¡å—ï¼Œå®ƒä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œé€šè¿‡<code>parse()</code>å°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ª<code>Url</code>å¯¹è±¡</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;http://user:pass@host.com:8080/path/to/file?query=string#hash&#39;</span><span class="p">));</span>
</code></pre></div>
<p>ç»“æœä¸º</p>
<div class="highlight"><pre><span></span><code><span class="nx">Url</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">protocol</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http:&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">slashes</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">auth</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user:pass&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;host.com:8080&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;8080&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">hostname</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;host.com&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">hash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#hash&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">search</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;?query=string&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;query=string&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">pathname</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/path/to/file&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/path/to/file?query=string&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">href</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://user:pass@host.com:8080/path/to/file?query=string#hash&#39;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨<code>file_server.js</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span>
<span class="w">    </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="c1">// ä»å‘½ä»¤è¡Œå‚æ•°è·å–rootç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Static root dir: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">root</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºæœåŠ¡å™¨:</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è·å¾—URLçš„pathï¼Œç±»ä¼¼ &#39;/css/bootstrap.css&#39;:</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pathname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// è·å¾—å¯¹åº”çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œç±»ä¼¼ &#39;/srv/www/css/bootstrap.css&#39;:</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="w"> </span><span class="nx">pathname</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// è·å–æ–‡ä»¶çŠ¶æ€:</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">filepath</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">stats</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">stats</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ²¡æœ‰å‡ºé”™å¹¶ä¸”æ–‡ä»¶å­˜åœ¨:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;200 &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// å‘é€200å“åº”:</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// å°†æ–‡ä»¶æµå¯¼å‘response:</span>
<span class="w">            </span><span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">filepath</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// å‡ºé”™äº†æˆ–è€…æ–‡ä»¶ä¸å­˜åœ¨:</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;404 &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="w">            </span><span class="c1">// å‘é€404å“åº”:</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">404</span><span class="p">);</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;404 Not Found&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8080</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server is running at http://127.0.0.1:8080/&#39;</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>æ²¡æœ‰å¿…è¦æ‰‹åŠ¨è¯»å–æ–‡ä»¶å†…å®¹ã€‚ç”±äº<code>response</code>å¯¹è±¡æœ¬èº«æ˜¯ä¸€ä¸ª<code>Writable Stream</code>ï¼Œç›´æ¥ç”¨<code>pipe()</code>æ–¹æ³•å°±å®ç°äº†è‡ªåŠ¨è¯»å–æ–‡ä»¶å†…å®¹å¹¶è¾“å‡ºåˆ°HTTPå“åº”ã€‚</li>
</ul>
<h4 id="crypto">crypto æ¨¡å—<a class="headerlink" href="#crypto" title="Permanent link">&para;</a></h4>
<ul>
<li>cryptoæ¨¡å—çš„ç›®çš„æ˜¯ä¸ºäº†æä¾›é€šç”¨çš„åŠ å¯†å’Œå“ˆå¸Œç®—æ³•ã€‚ç”¨çº¯JavaScriptä»£ç å®ç°è¿™äº›åŠŸèƒ½ä¸æ˜¯ä¸å¯èƒ½ï¼Œä½†é€Ÿåº¦ä¼šéå¸¸æ…¢ã€‚Nodejsç”¨C/C++å®ç°è¿™äº›ç®—æ³•åï¼Œé€šè¿‡cyptoè¿™ä¸ªæ¨¡å—æš´éœ²ä¸ºJavaScriptæ¥å£ï¼Œè¿™æ ·ç”¨èµ·æ¥æ–¹ä¾¿ï¼Œè¿è¡Œé€Ÿåº¦ä¹Ÿå¿«ã€‚</li>
<li>hash<ul>
<li><code>const hash = crypto.createHash('md5');</code> å¯ä»¥æ˜¯ md5, sha1, sha256, sha512</li>
<li>å¯ä»¥ä»»æ„æ¬¡ <code>hash.update('Hello, world!');</code>. é»˜è®¤å­—ç¬¦ä¸²ç¼–ç ä¸º<code>UTF-8</code>ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥Buffer</li>
<li>å¾—åˆ° hash å€¼ <code>hash.digest('hex')</code></li>
</ul>
</li>
<li>Hmac ç®—æ³•ä¹Ÿæ˜¯ä¸€ç§ hash ç®—æ³•, ä¸åŒçš„æ˜¯éœ€è¦ä¸€ä¸ªå¯†é’¥<ul>
<li><code>const hmac = crypto.createHmac('sha256', 'secret-key');</code></li>
</ul>
</li>
<li>AES<ul>
<li>AESæ˜¯ä¸€ç§å¸¸ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŠ è§£å¯†éƒ½ç”¨åŒä¸€ä¸ªå¯†é’¥.</li>
<li>åŒ…æ‹¬ aes192, aes-128-ecb, aes-256-cbc ç­‰</li>
<li><code>const cipher = crypto.createCipher('aes192', key);</code></li>
<li><code>const decipher = crypto.createDecipher('aes192', key);</code></li>
</ul>
</li>
<li>Diffie-Hellman<ul>
<li>DHç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢åè®®ï¼Œå®ƒå¯ä»¥è®©åŒæ–¹åœ¨ä¸æ³„æ¼å¯†é’¥çš„æƒ…å†µä¸‹åå•†å‡ºä¸€ä¸ªå¯†é’¥æ¥</li>
<li><code>crypto.createDiffieHellman</code></li>
</ul>
</li>
<li>RSA<ul>
<li>RSAç®—æ³•æ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå³ç”±ä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªå…¬é’¥æ„æˆçš„å¯†é’¥å¯¹ï¼Œé€šè¿‡ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œæˆ–è€…é€šè¿‡å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</li>
<li>å½“å°æ˜ç»™å°çº¢å‘é€ä¿¡æ¯æ—¶ï¼Œå¯ä»¥ç”¨å°æ˜è‡ªå·±çš„ç§é’¥åŠ å¯†ï¼Œå°çº¢ç”¨å°æ˜çš„å…¬é’¥è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç”¨å°çº¢çš„å…¬é’¥åŠ å¯†ï¼Œå°çº¢ç”¨å¥¹è‡ªå·±çš„ç§é’¥è§£å¯†ï¼Œè¿™å°±æ˜¯éå¯¹ç§°åŠ å¯†ã€‚ç›¸æ¯”å¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†åªéœ€è¦æ¯ä¸ªäººå„è‡ªæŒæœ‰è‡ªå·±çš„ç§é’¥ï¼ŒåŒæ—¶å…¬å¼€è‡ªå·±çš„å…¬é’¥ï¼Œä¸éœ€è¦åƒAESé‚£æ ·ç”±ä¸¤ä¸ªäººå…±äº«åŒä¸€ä¸ªå¯†é’¥ã€‚</li>
<li>ä½¿ç”¨ç§é’¥åŠ å¯† <code>let enc_by_prv = crypto.privateEncrypt(prvKey, Buffer.from(message, 'utf8'));</code> è¿”å›çš„æ˜¯ Buffer</li>
<li>ä½¿ç”¨å…¬é’¥è§£å¯† <code>let dec_by_pub = crypto.publicDecrypt(pubKey, enc_by_prv);</code></li>
<li>RSAåŠ å¯†çš„åŸå§‹ä¿¡æ¯å¿…é¡»å°äºKeyçš„é•¿åº¦ã€‚é‚£å¦‚ä½•ç”¨RSAåŠ å¯†ä¸€ä¸ªå¾ˆé•¿çš„æ¶ˆæ¯å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒRSAå¹¶ä¸é€‚åˆåŠ å¯†å¤§æ•°æ®ï¼Œè€Œæ˜¯å…ˆç”Ÿæˆä¸€ä¸ªéšæœºçš„AESå¯†ç ï¼Œç”¨AESåŠ å¯†åŸå§‹ä¿¡æ¯ï¼Œç„¶åç”¨RSAåŠ å¯†AESå£ä»¤ï¼Œè¿™æ ·ï¼Œå®é™…ä½¿ç”¨RSAæ—¶ï¼Œç»™å¯¹æ–¹ä¼ çš„å¯†æ–‡åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯AESåŠ å¯†çš„å¯†æ–‡ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯RSAåŠ å¯†çš„AESå£ä»¤ã€‚å¯¹æ–¹ç”¨RSAå…ˆè§£å¯†å‡ºAESå£ä»¤ï¼Œå†ç”¨AESè§£å¯†å¯†æ–‡ï¼Œå³å¯è·å¾—æ˜æ–‡ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* å°è£… AES å‡½æ•°ä¾¿äºä½¿ç”¨ */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">aesEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">createCipher</span><span class="p">(</span><span class="s1">&#39;aes192&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">crypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">crypted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">crypted</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">aesDecrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">decipher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">createDecipher</span><span class="p">(</span><span class="s1">&#39;aes192&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">decrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decipher</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hex&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">decrypted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">decipher</span><span class="p">.</span><span class="kr">final</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">decrypted</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello, this is a secret message!&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Password!&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aesEncrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">decrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aesDecrypt</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Plain text: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Encrypted text: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">encrypted</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Decrypted text: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">decrypted</span><span class="p">);</span>
</code></pre></div>
<p>ç”ŸæˆRSAå¯†é’¥</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ç”Ÿæˆä¸€ä¸ªRSAå¯†é’¥å¯¹</span>
<span class="c1"># éœ€è¦è¾“å…¥å¯†ç , è¿™ä¸ªå¯†ç æ˜¯ç”¨æ¥åŠ å¯†RSAå¯†é’¥çš„; åŠ å¯†æ–¹å¼æŒ‡å®šä¸ºAES256ï¼Œç”Ÿæˆçš„RSAçš„å¯†é’¥é•¿åº¦æ˜¯2048ä½</span>
openssl<span class="w"> </span>genrsa<span class="w"> </span>-aes256<span class="w"> </span>-out<span class="w"> </span>rsa-key.pem<span class="w"> </span><span class="m">2048</span>
<span class="c1"># å¯¼å‡ºç§é’¥å’Œå…¬é’¥, éœ€è¦è¾“å…¥ä¹‹å‰çš„å¯†ç </span>
openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>rsa-key.pem<span class="w"> </span>-outform<span class="w"> </span>PEM<span class="w"> </span>-out<span class="w"> </span>rsa-prv.pem
openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>rsa-key.pem<span class="w"> </span>-outform<span class="w"> </span>PEM<span class="w"> </span>-pubout<span class="w"> </span>-out<span class="w"> </span>rsa-pub.pem
</code></pre></div>
<h3 id="web">Web å¼€å‘<a class="headerlink" href="#web" title="Permanent link">&para;</a></h3>
<ul>
<li>æœ€æ—©çš„è½¯ä»¶éƒ½æ˜¯è¿è¡Œåœ¨å¤§å‹æœºä¸Šçš„ï¼Œè½¯ä»¶ä½¿ç”¨è€…é€šè¿‡â€œå“‘ç»ˆç«¯â€ç™»é™†åˆ°å¤§å‹æœºä¸Šå»è¿è¡Œè½¯ä»¶ã€‚åæ¥éšç€PCæœºçš„å…´èµ·ï¼Œè½¯ä»¶å¼€å§‹ä¸»è¦è¿è¡Œåœ¨æ¡Œé¢ä¸Šï¼Œè€Œæ•°æ®åº“è¿™æ ·çš„è½¯ä»¶è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿™ç§Client/Serveræ¨¡å¼ç®€ç§°CSæ¶æ„ã€‚</li>
<li>éšç€äº’è”ç½‘çš„å…´èµ·ï¼Œäººä»¬å‘ç°ï¼ŒCSæ¶æ„ä¸é€‚åˆWebï¼Œæœ€å¤§çš„åŸå› æ˜¯Webåº”ç”¨ç¨‹åºçš„ä¿®æ”¹å’Œå‡çº§éå¸¸è¿…é€Ÿï¼Œè€ŒCSæ¶æ„éœ€è¦æ¯ä¸ªå®¢æˆ·ç«¯é€ä¸ªå‡çº§æ¡Œé¢Appï¼Œå› æ­¤ï¼ŒBrowser/Serveræ¨¡å¼å¼€å§‹æµè¡Œï¼Œç®€ç§°BSæ¶æ„ã€‚<ul>
<li>åœ¨BSæ¶æ„ä¸‹ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æµè§ˆå™¨ï¼Œåº”ç”¨ç¨‹åºçš„é€»è¾‘å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚æµè§ˆå™¨åªéœ€è¦è¯·æ±‚æœåŠ¡å™¨ï¼Œè·å–Webé¡µé¢ï¼Œå¹¶æŠŠWebé¡µé¢å±•ç¤ºç»™ç”¨æˆ·å³å¯ã€‚</li>
<li>ä»Šå¤©ï¼Œé™¤äº†é‡é‡çº§çš„è½¯ä»¶å¦‚Officeï¼ŒPhotoshopç­‰ï¼Œå¤§éƒ¨åˆ†è½¯ä»¶éƒ½ä»¥Webå½¢å¼æä¾›ã€‚æ¯”å¦‚ï¼Œæ–°æµªæä¾›çš„æ–°é—»ã€åšå®¢ã€å¾®åšç­‰æœåŠ¡ï¼Œå‡æ˜¯Webåº”ç”¨ã€‚</li>
</ul>
</li>
<li>Webå¼€å‘ä¹Ÿç»å†äº†å¥½å‡ ä¸ªé˜¶æ®µï¼š<ul>
<li>Â·CGIï¼šç”±äºé™æ€Webé¡µé¢æ— æ³•ä¸ç”¨æˆ·äº¤äº’ï¼Œæ¯”å¦‚ç”¨æˆ·å¡«å†™äº†ä¸€ä¸ªæ³¨å†Œè¡¨å•ï¼Œé™æ€Webé¡µé¢å°±æ— æ³•å¤„ç†ã€‚è¦å¤„ç†ç”¨æˆ·å‘é€çš„åŠ¨æ€æ•°æ®ï¼Œå‡ºç°äº†Common Gateway Interfaceï¼Œç®€ç§°CGIï¼Œç”¨C/C++ç¼–å†™ã€‚</li>
<li>ASP/JSP/PHPï¼šç”±äºWebåº”ç”¨ç‰¹ç‚¹æ˜¯ä¿®æ”¹é¢‘ç¹ï¼Œç”¨C/C++è¿™æ ·çš„ä½çº§è¯­è¨€éå¸¸ä¸é€‚åˆWebå¼€å‘ï¼Œè€Œè„šæœ¬è¯­è¨€ç”±äºå¼€å‘æ•ˆç‡é«˜ï¼Œä¸HTMLç»“åˆç´§å¯†ï¼Œå› æ­¤ï¼Œè¿…é€Ÿå–ä»£äº†CGIæ¨¡å¼ã€‚ASPæ˜¯å¾®è½¯æ¨å‡ºçš„ç”¨VBScriptè„šæœ¬ç¼–ç¨‹çš„Webå¼€å‘æŠ€æœ¯ï¼Œè€ŒJSPç”¨Javaæ¥ç¼–å†™è„šæœ¬ï¼ŒPHPæœ¬èº«åˆ™æ˜¯å¼€æºçš„è„šæœ¬è¯­è¨€ã€‚</li>
<li>MVCï¼šä¸ºäº†è§£å†³ç›´æ¥ç”¨è„šæœ¬è¯­è¨€åµŒå…¥HTMLå¯¼è‡´çš„å¯ç»´æŠ¤æ€§å·®çš„é—®é¢˜ï¼ŒWebåº”ç”¨ä¹Ÿå¼•å…¥äº†Model-View-Controllerçš„æ¨¡å¼ï¼Œæ¥ç®€åŒ–Webå¼€å‘ã€‚ASPå‘å±•ä¸ºASP.Netï¼ŒJSPå’ŒPHPä¹Ÿæœ‰ä¸€å¤§å †MVCæ¡†æ¶ã€‚</li>
</ul>
</li>
<li>ç”±äºNode.jsæŠŠJavaScriptå¼•å…¥äº†æœåŠ¡å™¨ç«¯ï¼Œå› æ­¤ï¼ŒåŸæ¥å¿…é¡»ä½¿ç”¨PHP/Java/C#/Python/Rubyç­‰å…¶ä»–è¯­è¨€æ¥å¼€å‘æœåŠ¡å™¨ç«¯ç¨‹åºï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨Node.jså¼€å‘äº†ï¼<ul>
<li>åœ¨Node.jsè¯ç”Ÿåçš„çŸ­çŸ­å‡ å¹´é‡Œï¼Œå‡ºç°äº†æ— æ•°ç§Webæ¡†æ¶ã€ORMæ¡†æ¶ã€æ¨¡ç‰ˆå¼•æ“ã€æµ‹è¯•æ¡†æ¶ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·</li>
<li>å¸¸è§çš„Webæ¡†æ¶åŒ…æ‹¬ï¼š<a href="http://expressjs.com/">Express</a>ï¼Œ<a href="http://sailsjs.org/">Sails.js</a>ï¼Œ<a href="http://koajs.com/">koa</a>ï¼Œ<a href="https://www.meteor.com/">Meteor</a>ï¼Œ<a href="http://derbyjs.com/">DerbyJS</a>ï¼Œ<a href="https://www.totaljs.com/">Total.js</a>ï¼Œ<a href="http://restify.com/">restify</a>â€¦â€¦</li>
<li>ORM æ¡†æ¶æ¯”Webæ¡†æ¶è¦å°‘ä¸€äº›ï¼š<a href="http://www.sequelizejs.com/">Sequelize</a>ï¼Œ<a href="http://dresende.github.io/node-orm2/">ORM2</a>ï¼Œ<a href="http://bookshelfjs.org/">Bookshelf.js</a>ï¼Œ<a href="http://vincit.github.io/objection.js/">Objection.js</a>â€¦â€¦</li>
<li>æ¨¡ç‰ˆå¼•æ“PKï¼š<a href="http://jade-lang.com/">Jade</a>ï¼Œ<a href="http://ejs.co/">EJS</a>ï¼Œ<a href="https://github.com/paularmstrong/swig">Swig</a>ï¼Œ<a href="http://mozilla.github.io/nunjucks/">Nunjucks</a>ï¼Œ<a href="http://olado.github.io/doT/">doT.js</a>â€¦â€¦</li>
<li>æµ‹è¯•æ¡†æ¶åŒ…æ‹¬ï¼š<a href="http://mochajs.org/">Mocha</a>ï¼Œ<a href="http://visionmedia.github.io/expresso/">Expresso</a>ï¼Œ<a href="http://unitjs.com/">Unit.js</a>ï¼Œ<a href="http://karma-runner.github.io/">Karma</a>â€¦â€¦</li>
<li>æ„å»ºå·¥å…·æœ‰ï¼š<a href="http://gruntjs.com/">Grunt</a>ï¼Œ<a href="http://gulpjs.com/">Gulp</a>ï¼Œ<a href="http://webpack.github.io/">Webpack</a>â€¦â€¦</li>
</ul>
</li>
</ul>
<h4 id="koa">koa<a class="headerlink" href="#koa" title="Permanent link">&para;</a></h4>
<ul>
<li>koaæ˜¯Expressçš„ä¸‹ä¸€ä»£åŸºäºNode.jsçš„webæ¡†æ¶</li>
<li>å†å²<ul>
<li>Expressæ˜¯ç¬¬ä¸€ä»£æœ€æµè¡Œçš„webæ¡†æ¶ï¼Œå®ƒå¯¹Node.jsçš„httpè¿›è¡Œäº†å°è£…<ul>
<li>è™½ç„¶Expressçš„APIå¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºES5çš„è¯­æ³•ï¼Œè¦å®ç°å¼‚æ­¥ä»£ç ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼šå›è°ƒã€‚å¦‚æœå¼‚æ­¥åµŒå¥—å±‚æ¬¡è¿‡å¤šï¼Œä»£ç å†™èµ·æ¥å°±éå¸¸éš¾çœ‹</li>
</ul>
</li>
<li>koa 1.0<ul>
<li>éšç€æ–°ç‰ˆNode.jså¼€å§‹æ”¯æŒES6ï¼ŒExpressçš„å›¢é˜ŸåˆåŸºäºES6çš„generatoré‡æ–°ç¼–å†™äº†ä¸‹ä¸€ä»£webæ¡†æ¶koaã€‚å’ŒExpressç›¸æ¯”ï¼Œkoa 1.0ä½¿ç”¨generatorå®ç°å¼‚æ­¥ï¼Œä»£ç çœ‹èµ·æ¥åƒåŒæ­¥çš„</li>
<li>ç”¨generatorå®ç°å¼‚æ­¥æ¯”å›è°ƒç®€å•äº†ä¸å°‘ï¼Œä½†æ˜¯generatorçš„æœ¬æ„å¹¶ä¸æ˜¯å¼‚æ­¥ã€‚Promiseæ‰æ˜¯ä¸ºå¼‚æ­¥è®¾è®¡çš„ï¼Œä½†æ˜¯Promiseçš„å†™æ³•â€¦â€¦æƒ³æƒ³å°±å¤æ‚ã€‚ä¸ºäº†ç®€åŒ–å¼‚æ­¥ä»£ç ï¼ŒES7ï¼ˆç›®å‰æ˜¯è‰æ¡ˆï¼Œè¿˜æ²¡æœ‰å‘å¸ƒï¼‰å¼•å…¥äº†æ–°çš„å…³é”®å­—<code>async</code>å’Œ<code>await</code>ï¼Œå¯ä»¥è½»æ¾åœ°æŠŠä¸€ä¸ªfunctionå˜ä¸ºå¼‚æ­¥æ¨¡å¼</li>
</ul>
</li>
<li>koa2<ul>
<li>koaå›¢é˜Ÿå¹¶æ²¡æœ‰æ­¢æ­¥äºkoa 1.0ï¼Œä»–ä»¬éå¸¸è¶…å‰åœ°åŸºäºES7å¼€å‘äº†koa2ï¼Œå’Œkoa 1ç›¸æ¯”ï¼Œkoa2å®Œå…¨ä½¿ç”¨Promiseå¹¶é…åˆ<code>async</code>æ¥å®ç°å¼‚æ­¥ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="_7">å…¥é—¨<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h5>
<p>å¦‚ä½•å®‰è£… koa åŒ…?</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šå¯ä»¥ç”¨npmå‘½ä»¤ç›´æ¥å®‰è£…koaã€‚ <code>npm install koa@2.0.0</code></li>
<li>æ–¹æ³•äºŒï¼šåœ¨<code>hello-koa</code>è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>package.json</code>ï¼Œè¿™ä¸ªæ–‡ä»¶æè¿°äº†æˆ‘ä»¬çš„<code>hello-koa</code>å·¥ç¨‹ä¼šç”¨åˆ°å“ªäº›åŒ…ã€‚<ul>
<li>æœ€é‡è¦çš„æ˜¯åœ¨ <code>dependencies</code> ä¸­æŒ‡å®š <code>"koa": "2.0.0"</code></li>
<li><code>npm install</code></li>
</ul>
</li>
</ul>
<p>å¦‚ä½•è¿è¡Œ?</p>
<ul>
<li>ç‚¹å‡» VSCode ä¸Šçš„è¿è¡ŒæŒ‰é’® (å¯ä»¥çœ‹åˆ°è°ƒç”¨äº† node å‘½ä»¤)</li>
<li>ç›´æ¥ç”¨å‘½ä»¤ <code>node app.js</code> åœ¨å‘½ä»¤è¡Œå¯åŠ¨ç¨‹åº</li>
<li>æˆ–è€…ç”¨<code>npm start</code>å¯åŠ¨ã€‚<code>npm start</code> å‘½ä»¤ä¼šè®©npmæ‰§è¡Œå®šä¹‰åœ¨ <code>package.json</code> æ–‡ä»¶ä¸­çš„startå¯¹åº”å‘½ä»¤.<ul>
<li>åœ¨ <code>scripts</code> ä¸­æŒ‡å®š <code>"start": "node --use_strict app.js"</code></li>
</ul>
</li>
</ul>
<h5 id="koa-middleware">koa middleware<a class="headerlink" href="#koa-middleware" title="Permanent link">&para;</a></h5>
<ul>
<li>æ ¸å¿ƒä»£ç <ul>
<li><code>app.use(async (ctx, next) =&gt; {}</code></li>
<li>æ¯æ”¶åˆ°ä¸€ä¸ªhttpè¯·æ±‚ï¼Œkoaå°±ä¼šè°ƒç”¨é€šè¿‡<code>app.use()</code>æ³¨å†Œçš„asyncå‡½æ•°ï¼Œå¹¶ä¼ å…¥<code>ctx</code>å’Œ<code>next</code>å‚æ•°ã€‚<ul>
<li>å‚æ•°<code>ctx</code>æ˜¯ç”±koaä¼ å…¥çš„å°è£…äº†requestå’Œresponseçš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒè®¿é—®requestå’Œresponseï¼Œ<code>next</code>æ˜¯koaä¼ å…¥çš„å°†è¦å¤„ç†çš„ä¸‹ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚</li>
<li>ç”±<code>async</code>æ ‡è®°çš„å‡½æ•°ç§°ä¸ºå¼‚æ­¥å‡½æ•°ï¼Œåœ¨å¼‚æ­¥å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨<code>await</code>è°ƒç”¨å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—å°†åœ¨ES7ä¸­å¼•å…¥ã€‚</li>
</ul>
</li>
<li>koaæŠŠå¾ˆå¤šasyncå‡½æ•°ç»„æˆä¸€ä¸ªå¤„ç†é“¾ï¼Œæ¯ä¸ªasyncå‡½æ•°éƒ½å¯ä»¥åšä¸€äº›è‡ªå·±çš„äº‹æƒ…ï¼Œç„¶åç”¨<code>await next()</code>æ¥è°ƒç”¨ä¸‹ä¸€ä¸ªasyncå‡½æ•°ã€‚æˆ‘ä»¬æŠŠæ¯ä¸ªasyncå‡½æ•°ç§°ä¸ºmiddlewareï¼Œè¿™äº›middlewareå¯ä»¥ç»„åˆèµ·æ¥ï¼Œå®Œæˆå¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* app.js */</span>
<span class="c1">// å¯¼å…¥koaï¼Œå’Œkoa 1.xä¸åŒï¼Œåœ¨koa2ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥çš„æ˜¯ä¸€ä¸ªclassï¼Œå› æ­¤ç”¨å¤§å†™çš„Koaè¡¨ç¤º:</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">Koa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa&#39;</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºä¸€ä¸ªKoaå¯¹è±¡è¡¨ç¤ºweb appæœ¬èº«:</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Koa</span><span class="p">();</span>

<span class="c1">// å¯¹äºä»»ä½•è¯·æ±‚ï¼Œappå°†è°ƒç”¨è¯¥å¼‚æ­¥å‡½æ•°å¤„ç†è¯·æ±‚ï¼š</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;text/html&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;h1&gt;Hello, koa2!&lt;/h1&gt;&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// åœ¨ç«¯å£3000ç›‘å¬:</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;app started at port 3000...&#39;</span><span class="p">);</span>
</code></pre></div>
<p>å¤„ç†é“¾ç¤ºä¾‹å¦‚ä¸‹ (è§‚å¯Ÿ next å‡½æ•°çš„ä½ç½®)</p>
<div class="highlight"><pre><span></span><code><span class="c1">// å¯ä»¥ç”¨ä»¥ä¸‹3ä¸ªmiddlewareç»„æˆå¤„ç†é“¾ï¼Œä¾æ¬¡æ‰“å°æ—¥å¿—ï¼Œè®°å½•å¤„ç†æ—¶é—´ï¼Œè¾“å‡ºHTML</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// æ‰“å°URL</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// è°ƒç”¨ä¸‹ä¸€ä¸ªmiddleware</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span><span class="w"> </span><span class="c1">// å½“å‰æ—¶é—´</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span><span class="w"> </span><span class="c1">// è°ƒç”¨ä¸‹ä¸€ä¸ªmiddleware</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">start</span><span class="p">;</span><span class="w"> </span><span class="c1">// è€—è´¹æ—¶é—´</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Time: </span><span class="si">${</span><span class="nx">ms</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span><span class="w"> </span><span class="c1">// æ‰“å°è€—è´¹æ—¶é—´</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;text/html&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;h1&gt;Hello, koa2!&lt;/h1&gt;&#39;</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="url">å¤„ç†URL<a class="headerlink" href="#url" title="Permanent link">&para;</a></h5>
<ul>
<li><code>koa-router</code><ul>
<li>ä¸ºäº†å¤„ç†URLï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥<code>koa-router</code>è¿™ä¸ªmiddlewareï¼Œè®©å®ƒè´Ÿè´£å¤„ç†URLæ˜ å°„</li>
<li>æ³¨æ„, å¯¼å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•° <code>const router = require('koa-router')();</code></li>
</ul>
</li>
<li>get<ul>
<li>ä½¿ç”¨<code>router.get('/path', async fn)</code>æ¥æ³¨å†Œä¸€ä¸ªGETè¯·æ±‚ã€‚</li>
<li>å¯ä»¥åœ¨è¯·æ±‚è·¯å¾„ä¸­ä½¿ç”¨å¸¦å˜é‡çš„<code>/hello/:name</code>ï¼Œå˜é‡å¯ä»¥é€šè¿‡<code>ctx.params.name</code>è®¿é—®ã€‚</li>
</ul>
</li>
<li><code>koa-bodyparser</code><ul>
<li>postè¯·æ±‚é€šå¸¸ä¼šå‘é€ä¸€ä¸ªè¡¨å•ï¼Œæˆ–è€…JSONï¼Œå®ƒä½œä¸ºrequestçš„bodyå‘é€ï¼Œä½†æ— è®ºæ˜¯Node.jsæä¾›çš„åŸå§‹requestå¯¹è±¡ï¼Œè¿˜æ˜¯koaæä¾›çš„requestå¯¹è±¡ï¼Œéƒ½ ä¸æä¾› è§£ærequestçš„bodyçš„åŠŸèƒ½ï¼</li>
<li>å› æ­¤, éœ€è¦å¦ä¸€ä¸ª middleware <code>koa-bodyparser</code>. ç”¨å®ƒè§£æå‚æ•°ï¼Œç„¶åæŠŠè§£æåçš„å‚æ•°ï¼Œç»‘å®šåˆ°<code>ctx.request.body</code>ä¸­</li>
<li>éœ€è¦åœ¨åˆé€‚çš„ä½ç½®åŠ ä¸Š <code>app.use(bodyParser());</code></li>
</ul>
</li>
<li>post<ul>
<li><code>router.post('/path', async fn)</code></li>
<li>ç„¶åå¯ä»¥ç”¨ <code>ctx.request.body</code> å¾—åˆ°è§£æå¥½çš„ requestçš„body</li>
</ul>
</li>
<li>ç±»ä¼¼çš„ï¼Œputã€deleteã€headè¯·æ±‚ä¹Ÿå¯ä»¥ç”±routerå¤„ç†ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">Koa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa&#39;</span><span class="p">);</span>

<span class="c1">// æ³¨æ„require(&#39;koa-router&#39;)è¿”å›çš„æ˜¯å‡½æ•°:</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;koa-router&#39;</span><span class="p">)();</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Koa</span><span class="p">();</span>

<span class="c1">// log request URL:</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Process </span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">...`</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// add url-route:</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hello/:name&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;h1&gt;Hello, </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">!&lt;/h1&gt;`</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;h1&gt;Index&lt;/h1&gt;&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// add router middleware:</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">router</span><span class="p">.</span><span class="nx">routes</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;app started at port 3000...&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// è¿™æ ·æ‰èƒ½è§£æåˆ° ctx.request.body !</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">());</span>
<span class="cm">/* å†™ä¸€ä¸ªç®€å•çš„ç™»å½•è¡¨å• */</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;h1&gt;Index&lt;/h1&gt;</span>
<span class="sb">        &lt;form action=&quot;/signin&quot; method=&quot;post&quot;&gt;</span>
<span class="sb">            &lt;p&gt;Name: &lt;input name=&quot;name&quot; value=&quot;koa&quot;&gt;&lt;/p&gt;</span>
<span class="sb">            &lt;p&gt;Password: &lt;input name=&quot;password&quot; type=&quot;password&quot;&gt;&lt;/p&gt;</span>
<span class="sb">            &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/p&gt;</span>
<span class="sb">        &lt;/form&gt;`</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/signin&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`signin with name: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">, password: </span><span class="si">${</span><span class="nx">password</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;koa&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;12345&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;h1&gt;Welcome, </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">!&lt;/h1&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;h1&gt;Login failed!&lt;/h1&gt;</span>
<span class="sb">        &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Try again&lt;/a&gt;&lt;/p&gt;`</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="controller-middleware">Controller Middleware<a class="headerlink" href="#controller-middleware" title="Permanent link">&para;</a></h5>
<ul>
<li>å¯¹äºä¸åŒ URL çš„å“åº”, åº”è¯¥ä» <code>app.js</code> ä¸­åˆ†ç¦»å‡ºæ¥, ä¹Ÿå³ Controller Middleware</li>
<li>å› æ­¤, å¯¹äºä»£ç é‡æ„<ul>
<li>å°†å¤„ç† URL çš„ä»£ç  (å¤„ç†å‡½æ•°) éƒ½æ”¾åœ¨ä¸€ä¸ª <code>controllers</code> æ–‡ä»¶å¤¹ä¸­</li>
<li>ç”¨ä¸“é—¨çš„ä¸€ä¸ª <code>controller.js</code>, æ‰«æ<code>controllers</code>ç›®å½•å’Œåˆ›å»º<code>router</code>, ä½œä¸ºä¸€ä¸ªç®€å•çš„ middleware ä½¿ç”¨</li>
<li>è¿™æ ·, <code>app.js</code>çš„ä»£ç å¾—ä»¥ç®€åŒ–.</li>
</ul>
</li>
<li>ç»è¿‡é‡æ–°æ•´ç†åçš„å·¥ç¨‹ <code>url2-koa</code> ç›®å‰å…·å¤‡éå¸¸å¥½çš„æ¨¡å—åŒ–ï¼Œæ‰€æœ‰å¤„ç†URLçš„å‡½æ•°æŒ‰åŠŸèƒ½ç»„å­˜æ”¾åœ¨<code>controllers</code>ç›®å½•ï¼Œä»Šåæˆ‘ä»¬ä¹Ÿåªéœ€è¦ä¸æ–­å¾€è¿™ä¸ªç›®å½•ä¸‹åŠ ä¸œè¥¿å°±å¯ä»¥äº†ï¼Œ<code>app.js</code>ä¿æŒä¸å˜ã€‚</li>
</ul>
<h5 id="nunjucks">Nunjucks<a class="headerlink" href="#nunjucks" title="Permanent link">&para;</a></h5>
<ul>
<li>æ¨¡æ¿å¼•æ“<ul>
<li>æ¨¡æ¿å¼•æ“å°±æ˜¯åŸºäºæ¨¡æ¿é…åˆæ•°æ®æ„é€ å‡ºå­—ç¬¦ä¸²è¾“å‡ºçš„ä¸€ä¸ªç»„ä»¶ã€‚</li>
</ul>
</li>
<li>è¾“å‡ºHTMLæœ‰å‡ ä¸ªç‰¹åˆ«é‡è¦çš„é—®é¢˜éœ€è¦è€ƒè™‘ï¼š<ul>
<li>è½¬ä¹‰<ul>
<li>å¯¹ç‰¹æ®Šå­—ç¬¦è¦è½¬ä¹‰ï¼Œé¿å…å—åˆ°XSSæ”»å‡»ã€‚æ¯”å¦‚ï¼Œå¦‚æœå˜é‡<code>name</code>çš„å€¼ä¸æ˜¯<code>å°æ˜</code>ï¼Œè€Œæ˜¯<code>å°æ˜&lt;script&gt;...&lt;/script&gt;</code>ï¼Œæ¨¡æ¿å¼•æ“è¾“å‡ºçš„HTMLåˆ°äº†æµè§ˆå™¨ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œæ¶æ„JavaScriptä»£ç ã€‚</li>
</ul>
</li>
<li>æ ¼å¼åŒ–<ul>
<li>å¯¹ä¸åŒç±»å‹çš„å˜é‡è¦æ ¼å¼åŒ–ï¼Œæ¯”å¦‚ï¼Œè´§å¸éœ€è¦å˜æˆ<code>12,345.00</code>è¿™æ ·çš„æ ¼å¼ï¼Œæ—¥æœŸéœ€è¦å˜æˆ<code>2016-01-01</code>è¿™æ ·çš„æ ¼å¼ã€‚</li>
</ul>
</li>
<li>ç®€å•é€»è¾‘<ul>
<li>æ¨¡æ¿è¿˜éœ€è¦èƒ½æ‰§è¡Œä¸€äº›ç®€å•é€»è¾‘ï¼Œæ¯”å¦‚ï¼Œè¦æŒ‰æ¡ä»¶è¾“å‡ºå†…å®¹</li>
</ul>
</li>
</ul>
</li>
<li>Nunjucks<ul>
<li>æˆ‘ä»¬é€‰æ‹©Nunjucksä½œä¸ºæ¨¡æ¿å¼•æ“ã€‚Nunjucksæ˜¯ Mozilla å¼€å‘çš„ä¸€ä¸ªçº¯JavaScriptç¼–å†™çš„æ¨¡æ¿å¼•æ“ï¼Œæ—¢å¯ä»¥ç”¨åœ¨Nodeç¯å¢ƒä¸‹ï¼Œåˆå¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ç«¯ã€‚ä½†æ˜¯ï¼Œä¸»è¦è¿˜æ˜¯è¿è¡Œåœ¨Nodeç¯å¢ƒä¸‹ï¼Œå› ä¸ºæµè§ˆå™¨ç«¯æœ‰æ›´å¥½çš„æ¨¡æ¿è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚MVVMæ¡†æ¶ã€‚</li>
<li>å°±æ˜¯ç”¨ js é‡æ–°å®ç°äº† Pythonçš„æ¨¡æ¿å¼•æ“<a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017806952856928">jinja2</a></li>
</ul>
</li>
</ul>
<p>å¦‚ä½•ä½¿ç”¨æ¨¡æ¿å¼•æ“?</p>
<ul>
<li>åˆ›å»ºå¼•æ“å¯¹è±¡<ul>
<li><code>function render(view, model) {}</code></li>
<li><code>view</code>æ˜¯æ¨¡æ¿çš„åç§°ï¼ˆåˆç§°ä¸ºè§†å›¾ï¼‰ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªæ¨¡æ¿ï¼Œéœ€è¦é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚<code>model</code>å°±æ˜¯æ•°æ®ï¼Œåœ¨JavaScriptä¸­ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªç®€å•çš„Objectã€‚<code>render</code>å‡½æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±æ˜¯æ¨¡æ¿çš„è¾“å‡ºã€‚</li>
<li>åˆ›å»º<code>env</code>éœ€è¦çš„å‚æ•°å¯ä»¥æŸ¥çœ‹æ–‡æ¡£è·çŸ¥ã€‚</li>
<li>ä¸‹ä¾‹ä¸­, æˆ‘ä»¬ç”¨<code>opts.noCache || false</code>è¿™æ ·çš„ä»£ç ç»™æ¯ä¸ªå‚æ•°åŠ ä¸Šé»˜è®¤å€¼ï¼Œæœ€åä½¿ç”¨<code>new nunjucks.FileSystemLoader('views')</code>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸåŠ è½½å™¨ï¼Œä»<code>views</code>ç›®å½•è¯»å–æ¨¡æ¿ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">nunjucks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;nunjucks&#39;</span><span class="p">);</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">createEnv</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span>
<span class="w">        </span><span class="nx">autoescape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">autoescape</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">autoescape</span><span class="p">,</span>
<span class="w">        </span><span class="nx">noCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">noCache</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">watch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">watch</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">throwOnUndefined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">throwOnUndefined</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">nunjucks</span><span class="p">.</span><span class="nx">Environment</span><span class="p">(</span>
<span class="w">            </span><span class="ow">new</span><span class="w"> </span><span class="nx">nunjucks</span><span class="p">.</span><span class="nx">FileSystemLoader</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">noCache</span><span class="o">:</span><span class="w"> </span><span class="nx">noCache</span><span class="p">,</span>
<span class="w">                </span><span class="nx">watch</span><span class="o">:</span><span class="w"> </span><span class="nx">watch</span><span class="p">,</span>
<span class="w">            </span><span class="p">}),</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">autoescape</span><span class="o">:</span><span class="w"> </span><span class="nx">autoescape</span><span class="p">,</span>
<span class="w">                </span><span class="nx">throwOnUndefined</span><span class="o">:</span><span class="w"> </span><span class="nx">throwOnUndefined</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">filters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">filters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">env</span><span class="p">.</span><span class="nx">addFilter</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">.</span><span class="nx">filters</span><span class="p">[</span><span class="nx">f</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">env</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createEnv</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">watch</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">hex</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;0x&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mf">16</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<ul>
<li>ä½¿ç”¨å°±éå¸¸ç®€å•<ul>
<li>ä¾‹å¦‚, å†™ä¸€ä¸ªç®€å•çš„ html æ–‡ä»¶, å†…å®¹ä¸º <code>&lt;h1&gt;Hello {{ name }}&lt;/h1&gt;</code></li>
<li>æ•…æ„ä¼ å…¥ä¸€ä¸ªåŒ…å«ç‰¹æ®Šç¬¦å·çš„å¯¹è±¡: <code>var s = env.render('hello.html', { name: '&lt;script&gt;alert("å°æ˜")&lt;/script&gt;' });</code></li>
<li>å¯ä»¥çœ‹åˆ°ä¼šå¯¹äºç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ç§», è¿™æ ·å°±é¿å…äº†è¾“å‡ºæ¶æ„è„šæœ¬</li>
</ul>
</li>
<li>åŠŸèƒ½<ul>
<li>æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯</li>
<li>ç»§æ‰¿<ul>
<li>Nunjucksæ¨¡æ¿å¼•æ“æœ€å¼ºå¤§çš„åŠŸèƒ½åœ¨äºæ¨¡æ¿çš„ç»§æ‰¿ã€‚ä»”ç»†è§‚å¯Ÿå„ç§ç½‘ç«™å¯ä»¥å‘ç°ï¼Œç½‘ç«™çš„ç»“æ„å®é™…ä¸Šæ˜¯ç±»ä¼¼çš„ï¼Œå¤´éƒ¨ã€å°¾éƒ¨éƒ½æ˜¯å›ºå®šæ ¼å¼ï¼Œåªæœ‰ä¸­é—´é¡µé¢éƒ¨åˆ†å†…å®¹ä¸åŒã€‚å¦‚æœæ¯ä¸ªæ¨¡æ¿éƒ½é‡å¤å¤´å°¾ï¼Œä¸€æ—¦è¦ä¿®æ”¹å¤´éƒ¨æˆ–å°¾éƒ¨ï¼Œé‚£å°±éœ€è¦æ”¹åŠ¨æ‰€æœ‰æ¨¡æ¿ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- å¾ªç¯è¾“å‡ºåå­— --&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Fruits List<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    {% for f in fruits %}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ f }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {% endfor %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- base.html --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
{% block header %} <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Unnamed<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span> {% endblock %}
{% block body %} <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>No body<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> {% endblock %}
{% block footer %} <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>copyright<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> {% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- extend.html --&gt;</span>
{% extends &#39;base.html&#39; %}
{% block header %}<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ header }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>{% endblock %}
{% block body %}<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ body }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>{% endblock %}
</code></pre></div>
<h5 id="mvc">ä½¿ç”¨MVC<a class="headerlink" href="#mvc" title="Permanent link">&para;</a></h5>
<ul>
<li>MVCï¼šModel-View-Controllerï¼Œä¸­æ–‡åâ€œæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨â€ã€‚<ul>
<li>å¼‚æ­¥å‡½æ•°æ˜¯Cï¼šControllerï¼ŒControllerè´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œå–å‡ºç”¨æˆ·ä¿¡æ¯ç­‰ç­‰ï¼›</li>
<li>åŒ…å«å˜é‡<code>{{ name }}</code>çš„æ¨¡æ¿å°±æ˜¯Vï¼šViewï¼ŒViewè´Ÿè´£æ˜¾ç¤ºé€»è¾‘ï¼Œé€šè¿‡ç®€å•åœ°æ›¿æ¢ä¸€äº›å˜é‡ï¼ŒViewæœ€ç»ˆè¾“å‡ºçš„å°±æ˜¯ç”¨æˆ·çœ‹åˆ°çš„HTMLã€‚</li>
<li>Modelæ˜¯ç”¨æ¥ä¼ ç»™Viewçš„ï¼Œè¿™æ ·Viewåœ¨æ›¿æ¢å˜é‡çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»Modelä¸­å–å‡ºç›¸åº”çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p>å…·ä½“è€Œè¨€</p>
<ul>
<li>router é€»è¾‘<ul>
<li>åœ¨ <code>controller</code> æ–‡ä»¶å¤¹ä¸­, å®ç° <code>async (ctx, next) =&gt; {}</code> è¿™äº›å¼‚æ­¥å‡½æ•°, äº¤ç»™ koa è¿›è¡Œå¤„ç†</li>
<li>è¿™é‡Œç›´æ¥å†™äº† <code>ctx.render('index.html', {})</code>, å…¶ä¸­çš„ render æ˜¯æˆ‘ä»¬å®šä¹‰åœ¨ ctx ä¸Šçš„å‡½æ•°, ç”¨ nonjucks æ¸²æŸ“æ¨¡æ¿</li>
</ul>
</li>
<li>ç¼–å†™ view<ul>
<li>å†™ä¸€ä¸ª base.html ä½œä¸ºéª¨æ¶, å…¶ä»–æ¨¡æ¿ç›´æ¥ç»§æ‰¿å³å¯</li>
</ul>
</li>
<li>é›†æˆ Nunjucks<ul>
<li>é›†æˆNunjuckså®é™…ä¸Šä¹Ÿæ˜¯ç¼–å†™ä¸€ä¸ªmiddlewareï¼Œè¿™ä¸ªmiddlewareçš„ä½œç”¨æ˜¯ç»™<code>ctx</code>å¯¹è±¡ç»‘å®šä¸€ä¸ª<code>render(view, model)</code>çš„æ–¹æ³•ï¼Œè¿™æ ·ï¼Œåé¢çš„Controllerå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥æ¸²æŸ“æ¨¡æ¿äº†ã€‚</li>
</ul>
</li>
<li>ç¼–å†™ middleware<ul>
<li>ç¬¬ä¸€ä¸ªmiddlewareæ˜¯è®°å½•URLä»¥åŠé¡µé¢æ‰§è¡Œæ—¶é—´</li>
<li>ç¬¬äºŒä¸ªmiddlewareå¤„ç†é™æ€æ–‡ä»¶<ul>
<li>å¦‚æœæ˜¯é™æ€æ–‡ä»¶, è¿”å›å³å¯!</li>
<li>å¦‚æœä¸æ˜¯, <code>next()</code></li>
</ul>
</li>
<li>ç¬¬ä¸‰ä¸ªmiddlewareè§£æPOSTè¯·æ±‚</li>
<li>ç¬¬å››ä¸ªmiddlewareè´Ÿè´£ç»™<code>ctx</code>åŠ ä¸Š<code>render()</code>æ¥ä½¿ç”¨Nunjucks<ul>
<li>æ³¨æ„, è¿™é‡Œå¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚, éƒ½éœ€è¦åŠ ä¸Š render æ–¹æ³•, ç„¶åè°ƒç”¨ <code>next()</code> (åœ¨ä¸‹é¢çš„è·¯æœ‰ä¸­å†³å®šæ¸²æŸ“å“ªä¸€ä¸ªæ¨¡æ¿)</li>
</ul>
</li>
<li>æœ€åä¸€ä¸ªmiddlewareå¤„ç†URLè·¯ç”±</li>
</ul>
</li>
<li>å¼€å‘/ç”Ÿäº§ç¯å¢ƒ<ul>
<li>å¯ä»¥å®šä¹‰ä¸€ä¸ªå¸¸é‡ <code>isProduction</code> æ ¹æ®ç¯å¢ƒå˜é‡ <code>process.env.NODE_ENV</code> åˆ¤æ–­æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ</li>
<li>å¼€å‘:<ul>
<li>Nonjucks: å¼€å‘ç¯å¢ƒä¸‹ï¼Œå…³é—­ç¼“å­˜åï¼Œæˆ‘ä»¬ä¿®æ”¹Viewï¼Œå¯ä»¥ç›´æ¥åˆ·æ–°æµè§ˆå™¨çœ‹åˆ°æ•ˆæœï¼Œå¦åˆ™ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½å¿…é¡»é‡å¯Nodeç¨‹åºï¼Œä¼šæå¤§åœ°é™ä½å¼€å‘æ•ˆç‡</li>
<li>å¼€å‘ç¯å¢ƒä¸‹, æˆ‘ä»¬ç”¨ koa å¤„ç†é™æ€æ–‡ä»¶, è€Œç”Ÿäº§ç«¯ç›´æ¥äº¤ç»™ Nginx å¤„ç†</li>
</ul>
</li>
</ul>
</li>
<li>æŠ€å·§: æ‹“å±•<ul>
<li>æ³¨æ„åˆ°<code>ctx.render</code>å†…éƒ¨æ¸²æŸ“æ¨¡æ¿æ—¶ï¼ŒModelå¯¹è±¡å¹¶ä¸æ˜¯ä¼ å…¥çš„modelå˜é‡ï¼Œè€Œæ˜¯ <code>ctx.response.body = env.render(view, Object.assign({}, ctx.state || {}, model || {}));</code></li>
<li>é¦–å…ˆï¼Œ<code>model || {}</code>ç¡®ä¿äº†å³ä½¿ä¼ å…¥<code>undefined</code>ï¼Œmodelä¹Ÿä¼šå˜ä¸ºé»˜è®¤å€¼<code>{}</code></li>
<li><code>ctx.state || {}</code> ç›®çš„æ˜¯ä¸ºäº†èƒ½æŠŠä¸€äº›å…¬å…±çš„å˜é‡æ”¾å…¥<code>ctx.state</code>å¹¶ä¼ ç»™View<ul>
<li>ä¾‹å¦‚ï¼ŒæŸä¸ªmiddlewareè´Ÿè´£æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œå®ƒå¯ä»¥æŠŠå½“å‰ç”¨æˆ·æ”¾å…¥<code>ctx.state</code>ä¸­</li>
<li>è¿™æ ·å°±æ²¡æœ‰å¿…è¦åœ¨æ¯ä¸ªControllerçš„asyncå‡½æ•°ä¸­éƒ½æŠŠuserå˜é‡æ”¾å…¥modelä¸­</li>
</ul>
</li>
<li>ä½¿ç”¨ <code>Object.assign()</code> å°†é™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°æ„å¤–çš„å¯¹è±¡å±æ€§éƒ½å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­</li>
</ul>
</li>
</ul>
<p>å»ºè®®ç›´æ¥çœ‹ä»£ç , æ³¨æ„ koa æ·»åŠ  run å‡½æ•°çš„æ‰§è¡Œé€»è¾‘.</p>
<h4 id="mysql">mysql<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h4>
<ul>
<li>å¼€æºæ•°æ®åº“<ul>
<li>MySQLï¼Œå¤§å®¶éƒ½åœ¨ç”¨ï¼Œä¸€èˆ¬é”™ä¸äº†ï¼›</li>
<li>PostgreSQLï¼Œå­¦æœ¯æ°”æ¯æœ‰ç‚¹é‡ï¼Œå…¶å®æŒºä¸é”™ï¼Œä½†çŸ¥ååº¦æ²¡æœ‰MySQLé«˜ï¼›</li>
<li>sqliteï¼ŒåµŒå…¥å¼æ•°æ®åº“ï¼Œé€‚åˆæ¡Œé¢å’Œç§»åŠ¨åº”ç”¨ã€‚</li>
</ul>
</li>
<li>å®‰è£…<ul>
<li><code>brew install mysql</code></li>
<li><code>brew services start mysql</code></li>
<li><code>mysql -uroot</code></li>
</ul>
</li>
</ul>
<h5 id="sequelize">Sequelize<a class="headerlink" href="#sequelize" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1">// å¦‚æœç›´æ¥ä½¿ç”¨`mysql2`åŒ…æä¾›çš„æ¥å£ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç å°±æ¯”è¾ƒåº•å±‚ï¼Œä¾‹å¦‚ï¼ŒæŸ¥è¯¢ä»£ç </span>
<span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users WHERE id = ?&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;123&#39;</span><span class="p">],</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// error</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">processRow</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Sequelize æ–¹å¼</span>
<span class="nx">Pet</span><span class="p">.</span><span class="nx">findAll</span><span class="p">()</span>
<span class="w">   </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">pets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">pet</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">pets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">           </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">pet</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">pet</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">   </span><span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// error</span>
<span class="w">   </span><span class="p">});</span>

<span class="c1">// é‡‡ç”¨ async æ–¹å¼</span>
<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// æ³¨æ„ await å¿…é¡»åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Pet</span><span class="p">.</span><span class="nx">findAll</span><span class="p">();</span>
<span class="p">})();</span>
</code></pre></div>
<p>ç”Ÿæˆæ•°æ®</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- create</span>
<span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>

<span class="c1">-- create &amp; grant user</span>
<span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="s1">&#39;www&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;www&#39;</span><span class="p">;</span>
<span class="k">grant</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="k">privileges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s1">&#39;www&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>

<span class="c1">-- create table</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">pets</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">gender</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">birth</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">createdAt</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">updatedAt</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="k">version</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="n">engine</span><span class="o">=</span><span class="n">innodb</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>ä½¿ç”¨ sequelize<ul>
<li>å®‰è£… <code>sequelize, mysql2</code></li>
<li>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªsequelizeå¯¹è±¡å®ä¾‹</li>
<li>ç¬¬äºŒæ­¥ï¼Œå®šä¹‰ <strong>æ¨¡å‹</strong> Petï¼Œå‘Šè¯‰Sequelizeå¦‚ä½•æ˜ å°„æ•°æ®åº“è¡¨<ul>
<li>ç”¨ <code>sequelize.define()</code> å®šä¹‰Modelæ—¶ï¼Œä¼ å…¥åç§° <code>pet</code>ï¼Œé»˜è®¤çš„è¡¨åå°±æ˜¯ <code>pets</code>ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šåˆ—åå’Œæ•°æ®ç±»å‹ï¼Œå¦‚æœæ˜¯ä¸»é”®ï¼Œéœ€è¦æ›´è¯¦ç»†åœ°æŒ‡å®šã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é¢å¤–çš„é…ç½®ï¼Œæˆ‘ä»¬ä¼ å…¥<code>{ timestamps: false }</code>æ˜¯ä¸ºäº†å…³é—­Sequelizeçš„è‡ªåŠ¨æ·»åŠ timestampçš„åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>æ“ä½œ<ul>
<li><code>create</code> æ’å…¥æ•°æ®</li>
<li><code>findAll</code> æŸ¥è¯¢<ul>
<li>å¯¹æŸ¥è¯¢åˆ°çš„å®ä¾‹è°ƒç”¨ <code>save, destory</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">Sequelize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sequelize&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config&#39;</span><span class="p">);</span>
<span class="c1">// ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªsequelizeå¯¹è±¡å®ä¾‹</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">sequelize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">database</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dialect</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">pool</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<span class="w">        </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">        </span><span class="nx">idle</span><span class="o">:</span><span class="w"> </span><span class="mf">30000</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
<span class="c1">// ç¬¬äºŒæ­¥ï¼Œå®šä¹‰æ¨¡å‹Petï¼Œå‘Šè¯‰Sequelizeå¦‚ä½•æ˜ å°„æ•°æ®åº“è¡¨</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">Pet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;pet&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">50</span><span class="p">),</span>
<span class="w">        </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span>
<span class="w">    </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BOOLEAN</span><span class="p">,</span>
<span class="w">    </span><span class="nx">birth</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">10</span><span class="p">),</span>
<span class="w">    </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span><span class="p">,</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span><span class="p">,</span>
<span class="w">    </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c1">// å…³é—­Sequelizeçš„è‡ªåŠ¨æ·»åŠ timestampçš„åŠŸèƒ½</span>
<span class="w">    </span><span class="p">});</span>
</code></pre></div>
<ul>
<li>Model<ul>
<li>æˆ‘ä»¬æŠŠé€šè¿‡<code>sequelize.define()</code>è¿”å›çš„<code>Pet</code>ç§°ä¸º <strong>Model</strong>ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ•°æ®æ¨¡å‹ã€‚</li>
<li>æˆ‘ä»¬æŠŠé€šè¿‡<code>Pet.findAll()</code>è¿”å›çš„ä¸€ä¸ªæˆ–ä¸€ç»„å¯¹è±¡ç§°ä¸ºModel <strong>å®ä¾‹</strong>ï¼Œæ¯ä¸ªå®ä¾‹éƒ½å¯ä»¥ç›´æ¥é€šè¿‡<code>JSON.stringify</code>åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ã€‚ä½†æ˜¯å®ƒä»¬å’Œæ™®é€šJSONå¯¹è±¡ç›¸æ¯”ï¼Œå¤šäº†ä¸€äº›ç”±Sequelizeæ·»åŠ çš„æ–¹æ³•ï¼Œæ¯”å¦‚<code>save()</code>å’Œ<code>destroy()</code>ã€‚è°ƒç”¨è¿™äº›æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œã€‚</li>
</ul>
</li>
<li>æ‰€ä»¥ï¼Œä½¿ç”¨Sequelizeæ“ä½œæ•°æ®åº“çš„ä¸€èˆ¬æ­¥éª¤å°±æ˜¯ï¼š<ul>
<li>é¦–å…ˆï¼Œé€šè¿‡æŸä¸ªModelå¯¹è±¡çš„<code>findAll()</code>æ–¹æ³•è·å–å®ä¾‹ï¼›<ul>
<li>æ³¨æ„<code>findAll()</code>æ–¹æ³•å¯ä»¥æ¥æ”¶<code>where</code>ã€<code>order</code>è¿™äº›å‚æ•°ï¼Œè¿™å’Œå°†è¦ç”Ÿæˆçš„SQLè¯­å¥æ˜¯å¯¹åº”çš„ã€‚</li>
</ul>
</li>
<li>å¦‚æœè¦æ›´æ–°å®ä¾‹ï¼Œå…ˆå¯¹å®ä¾‹å±æ€§èµ‹æ–°å€¼ï¼Œå†è°ƒç”¨<code>save()</code>æ–¹æ³•</li>
<li>å¦‚æœè¦åˆ é™¤å®ä¾‹ï¼Œç›´æ¥è°ƒç”¨<code>destroy()</code>æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// await å†™æ³• create</span>
<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">dog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Pet</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;d-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">now</span><span class="p">,</span>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Odie&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">birth</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2008-08-08&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="nx">now</span><span class="p">,</span>
<span class="w">        </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="nx">now</span><span class="p">,</span>
<span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;created: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">dog</span><span class="p">));</span>
<span class="p">})();</span>

<span class="cm">/* find &amp; save &amp; destroy æŸ¥è¯¢, ä¿®æ”¹, åˆ é™¤ */</span>
<span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">Pet</span><span class="p">.</span><span class="nx">findAll</span><span class="p">({</span>
<span class="w">        </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Gaffey&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`find </span><span class="si">${</span><span class="nx">pets</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> pets:`</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">p</span><span class="p">));</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;update pet...&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">p</span><span class="p">.</span><span class="nx">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="nx">p</span><span class="p">.</span><span class="nx">updatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">        </span><span class="nx">p</span><span class="p">.</span><span class="nx">version</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">version</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> was destroyed.`</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">})();</span>
</code></pre></div>
<h5 id="model">å»ºç«‹ Model<a class="headerlink" href="#model" title="Permanent link">&para;</a></h5>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹ï¼Œå¼ºè¿«æ‰€æœ‰Modeléƒ½éµå®ˆåŒä¸€ä¸ªè§„èŒƒï¼Œè¿™æ ·ä¸ä½†å®ç°ç®€å•ï¼Œè€Œä¸”å®¹æ˜“ç»Ÿä¸€é£æ ¼ã€‚</p>
<ol>
<li>ç»Ÿä¸€ä¸»é”®ï¼Œåç§°å¿…é¡»æ˜¯<code>id</code>ï¼Œç±»å‹å¿…é¡»æ˜¯<code>STRING(50)</code>ï¼›</li>
<li>ä¸»é”®å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä¹Ÿå¯ä»¥ç”±æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆï¼ˆå¦‚æœä¸ºnullæˆ–undefinedï¼‰ï¼›</li>
<li>æ‰€æœ‰å­—æ®µé»˜è®¤ä¸º<code>NOT NULL</code>ï¼Œé™¤éæ˜¾å¼æŒ‡å®šï¼›</li>
<li>ç»Ÿä¸€timestampæœºåˆ¶ï¼Œæ¯ä¸ªModelå¿…é¡»æœ‰<code>createdAt</code>ã€<code>updatedAt</code>å’Œ<code>version</code>ï¼Œåˆ†åˆ«è®°å½•åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´å’Œç‰ˆæœ¬å·ã€‚å…¶ä¸­ï¼Œ<code>createdAt</code>å’Œ<code>updatedAt</code>ä»¥<code>BIGINT</code>å­˜å‚¨æ—¶é—´æˆ³ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯æ— éœ€å¤„ç†æ—¶åŒºï¼Œæ’åºæ–¹ä¾¿ã€‚<code>version</code>æ¯æ¬¡ä¿®æ”¹æ—¶è‡ªå¢ã€‚</li>
</ol>
<p>å› æ­¤, æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>defineModel</code> å‡½æ•°, åˆ¶å®ç°ä¸Šè¿°è§„åˆ™ã€‚</p>
<ul>
<li>Sequelizeåœ¨åˆ›å»ºã€ä¿®æ”¹Entityæ—¶ä¼šè°ƒç”¨æˆ‘ä»¬æŒ‡å®šçš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°é€šè¿‡<code>hooks</code>åœ¨å®šä¹‰Modelæ—¶è®¾å®šã€‚æˆ‘ä»¬åœ¨<code>beforeValidate</code>è¿™ä¸ªäº‹ä»¶ä¸­æ ¹æ®æ˜¯å¦æ˜¯<code>isNewRecord</code>è®¾ç½®ä¸»é”®ï¼ˆå¦‚æœä¸»é”®ä¸º<code>null</code>æˆ–<code>undefined</code>ï¼‰ã€è®¾ç½®æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* è°ƒç”¨å½¢å¼ */</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">defineModel</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span>
<span class="w">        </span><span class="nx">unique</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">passwd</span><span class="o">:</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">STRING</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span>
<span class="w">    </span><span class="nx">gender</span><span class="o">:</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">BOOLEAN</span>
<span class="p">});</span>

<span class="cm">/* æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `defineModel` å‡½æ•°, åˆ¶å®ç°ä¸Šè¿°è§„åˆ™ã€‚ */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">defineModel</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">attributes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">attributes</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;object&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">value</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">value</span><span class="p">.</span><span class="nx">allowNull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">allowNull</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">            </span><span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">value</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">attrs</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span>
<span class="w">                </span><span class="nx">allowNull</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">ID_TYPE</span><span class="p">,</span>
<span class="w">        </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span><span class="p">,</span>
<span class="w">        </span><span class="nx">allowNull</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">updatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span><span class="p">,</span>
<span class="w">        </span><span class="nx">allowNull</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="nx">attrs</span><span class="p">.</span><span class="nx">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BIGINT</span><span class="p">,</span>
<span class="w">        </span><span class="nx">allowNull</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">attrs</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">hooks</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">beforeValidate</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">isNewRecord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">obj</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateId</span><span class="p">();</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">createdAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">updatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">now</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">updatedAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
<span class="w">                    </span><span class="nx">obj</span><span class="p">.</span><span class="nx">version</span><span class="o">++</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>æˆ‘ä»¬å…¶å®ä¸éœ€è¦åˆ›å»ºè¡¨çš„SQLï¼Œå› ä¸ºSequelizeæä¾›äº†ä¸€ä¸ª<code>sync()</code>æ–¹æ³•ï¼Œå¯ä»¥è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ã€‚<ul>
<li>è¿™ä¸ªåŠŸèƒ½åœ¨å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ã€‚æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>sync()</code>æ–¹æ³•è‡ªåŠ¨åˆ›å»ºå‡ºè¡¨ç»“æ„ï¼Œè€Œä¸æ˜¯è‡ªå·±ç»´æŠ¤SQLè„šæœ¬ã€‚è¿™æ ·ï¼Œå¯ä»¥éšæ—¶ä¿®æ”¹Modelçš„å®šä¹‰ï¼Œå¹¶ç«‹åˆ»è¿è¡Œæµ‹è¯•ã€‚</li>
<li>å¼€å‘ç¯å¢ƒä¸‹ï¼Œé¦–æ¬¡ä½¿ç”¨<code>sync()</code>ä¹Ÿå¯ä»¥è‡ªåŠ¨åˆ›å»ºå‡ºè¡¨ç»“æ„ï¼Œé¿å…äº†æ‰‹åŠ¨è¿è¡ŒSQLçš„é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* æš´éœ² sync å‡½æ•° */</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sync</span><span class="o">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// only allow create ddl in non-production environment:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="w"> </span><span class="nx">force</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
<span class="w">                </span><span class="s2">&quot;Cannot sync() when NODE_ENV is set to &#39;production&#39;.&quot;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* init-db.js */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./model.js&#39;</span><span class="p">);</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">sync</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;init db ok.&#39;</span><span class="p">);</span>
</code></pre></div>
<h4 id="mocha">mocha<a class="headerlink" href="#mocha" title="Permanent link">&para;</a></h4>
<ul>
<li>mochaæ˜¯JavaScriptçš„ä¸€ç§å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œæ—¢å¯ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨Node.jsç¯å¢ƒä¸‹è¿è¡Œã€‚</li>
<li>ç‰¹ç‚¹<ul>
<li>æ—¢å¯ä»¥æµ‹è¯•ç®€å•çš„JavaScriptå‡½æ•°ï¼Œåˆå¯ä»¥æµ‹è¯•å¼‚æ­¥ä»£ç ï¼Œå› ä¸ºå¼‚æ­¥æ˜¯JavaScriptçš„ç‰¹æ€§ä¹‹ä¸€ï¼›</li>
<li>å¯ä»¥è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•ï¼›</li>
<li>å¯ä»¥æ”¯æŒbeforeã€afterã€beforeEachå’ŒafterEachæ¥ç¼–å†™åˆå§‹åŒ–ä»£ç ã€‚</li>
</ul>
</li>
</ul>
<p>å¦‚ä½•æ‰§è¡Œæµ‹è¯•?</p>
<ul>
<li>æ–¹æ³•ä¸€ <code>node_modules\mocha\bin\mocha</code></li>
<li>æ–¹æ³•äºŒï¼Œæˆ‘ä»¬åœ¨<code>package.json</code>ä¸­æ·»åŠ npmå‘½ä»¤<ul>
<li>åœ¨ scripts ä¸­æ·»åŠ  <code>"test": "mocha"</code></li>
<li>ç„¶å <code>npm test</code> å³å¯</li>
</ul>
</li>
<li>æ–¹æ³•ä¸‰ï¼Œæˆ‘ä»¬åœ¨VS Codeä¸­åˆ›å»ºé…ç½®æ–‡ä»¶<code>.vscode/launch.json</code><ul>
<li><code>"program": "${workspaceRoot}/node_modules/mocha/bin/mocha"</code></li>
<li><code>"type": "node",</code></li>
<li>å…¶å®å°±æ˜¯è¿è¡Œäº† <code>node node_modules/mocha/bin/mocha</code> !</li>
</ul>
</li>
</ul>
<h5 id="_8">ç¼–å†™æµ‹è¯•<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">assert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../hello&#39;</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;#hello.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;#sum()&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">before</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;before:&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">after</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;after.&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  beforeEach:&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;  afterEach.&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;sum() should return 0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">sum</span><span class="p">(),</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;sum(1) should return 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">sum</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="_9">å¼‚æ­¥æµ‹è¯•<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h5>
<ul>
<li>å¦‚æœè¦æµ‹è¯•åŒæ­¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¼ å…¥æ— å‚æ•°å‡½æ•°å³å¯<ul>
<li><code>it(' description', function () {}</code></li>
<li>ç„¶ååœ¨å…¶ä¸­ assert åˆ¤æ–­å³å¯</li>
</ul>
</li>
<li>å¦‚æœè¦æµ‹è¯•å¼‚æ­¥å‡½æ•°ï¼Œæˆ‘ä»¬è¦ä¼ å…¥çš„å‡½æ•°éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œé€šå¸¸å‘½åä¸º<code>done</code><ul>
<li><code>it(' description', function (done) {}</code></li>
<li>ç„¶ååœ¨å…¶ä¸­è¿è¡Œä»£æµ‹è¯•çš„å‡½æ•° f</li>
<li>æ‰‹åŠ¨è°ƒç”¨<code>done()</code>è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼Œ<code>done(err)</code>è¡¨ç¤ºæµ‹è¯•å‡ºé”™</li>
</ul>
</li>
<li>å¯¹äº async å‡½æ•°, æ›´æ–¹ä¾¿çš„æ˜¯ç›´æ¥å°†å…¶è½¬åŒ–ä¸ºåŒæ­¥å‡½æ•°æµ‹è¯•<ul>
<li>ä¾‹å¦‚, ä¼ å…¥ <code>async () =&gt; { assert.strictEqual(await f(), groundTruth) }</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// å¦‚æœè¦æµ‹è¯•åŒæ­¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¼ å…¥æ— å‚æ•°å‡½æ•°å³å¯</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;test sync function&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// sycnFunc()</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// å¦‚æœè¦æµ‹è¯•å¼‚æ­¥å‡½æ•°ï¼Œæˆ‘ä»¬è¦ä¼ å…¥çš„å‡½æ•°éœ€è¦å¸¦ä¸€ä¸ªå‚æ•°ï¼Œé€šå¸¸å‘½åä¸º`done`</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;test async function&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// è¦æµ‹è¯•çš„å¼‚æ­¥å‡½æ•°, ä¾‹å¦‚è¿™é‡Œçš„ fs.readFile</span>
<span class="w">    </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;filepath&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// æµ‹è¯•å¼‚æ­¥å‡½æ•°éœ€è¦åœ¨å‡½æ•°å†…éƒ¨æ‰‹åŠ¨è°ƒç”¨`done()`è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼Œ`done(err)`è¡¨ç¤ºæµ‹è¯•å‡ºé”™ã€‚</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">done</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="c1">// å¯¹äº await å‡½æ•°</span>
<span class="c1">// 0. å¯ä»¥ç”¨ try...catch æµ‹è¯•</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;#async with done&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">hello</span><span class="p">();</span>
<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="mf">15</span><span class="p">);</span>
<span class="w">            </span><span class="nx">done</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})();</span>
<span class="p">});</span>
<span class="c1">// 1. æ›´æ–¹ä¾¿çš„, å°±æ˜¯ç›´æ¥æŠŠasyncå‡½æ•°å½“æˆåŒæ­¥å‡½æ•°æ¥æµ‹è¯•</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;#async function&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">hello</span><span class="p">();</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="mf">15</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="http_1">Http æµ‹è¯•<a class="headerlink" href="#http_1" title="Permanent link">&para;</a></h5>
<ul>
<li>ä» <code>app.js</code> ä¸­åˆ†ç¦»ç›´æ¥è¿è¡Œ (listen) çš„ä»£ç , ä»¤å…¶åªè´Ÿè´£åˆ›å»º<code>app</code>å®ä¾‹ï¼Œå¹¶ä¸ç›‘å¬ç«¯å£<ul>
<li>ä»è€Œå¯ä»¥åœ¨æµ‹è¯•ä¸­å¯¼å…¥ app ç„¶å <code>let server = app.listen(9900);</code></li>
</ul>
</li>
<li>åˆ©ç”¨ <code>supertest</code> ç®€åŒ– HTTP assertions<ul>
<li><code>request = require('supertest')</code></li>
<li>ä½¿ç”¨ <code>let res = await request(server).get('/');</code> æ„é€ ä¸€ä¸ªGETè¯·æ±‚ï¼Œå‘é€ç»™koaçš„åº”ç”¨ï¼Œç„¶åè·å¾—å“åº”</li>
<li>å¯ä»¥æ‰‹åŠ¨æ£€æŸ¥å“åº”å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œ<code>res.body</code>ï¼Œè¿˜å¯ä»¥åˆ©ç”¨<code>supertest</code>æä¾›çš„<code>expect()</code>æ›´æ–¹ä¾¿åœ°æ–­è¨€å“åº”çš„HTTPä»£ç ã€è¿”å›å†…å®¹å’ŒHTTPå¤´ã€‚æ–­è¨€HTTPå¤´æ—¶å¯ç”¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼<ul>
<li>ä¾‹å¦‚ <code>.expect('Content-Type', /text\/html/)</code> å¯ç”¨æˆåŠŸåŒ¹é…åˆ°<code>Content-Type</code>ä¸º<code>text/html</code>ã€<code>text/html; charset=utf-8</code>ç­‰å€¼ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å‚è§ <a href="https://www.npmjs.com/package/supertest">https://www.npmjs.com/package/supertest</a> ä¸­çš„ macha éƒ¨åˆ†</p>
<div class="highlight"><pre><span></span><code><span class="c1">// app-test.js</span>

<span class="kd">const</span>
<span class="w">    </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;supertest&#39;</span><span class="p">),</span>
<span class="w">    </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../app&#39;</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;#test koa app&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">9900</span><span class="p">);</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;#test server&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;#test GET /&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">server</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="sr">/text\/html/</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;#test GET /path?name=Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">server</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/path?name=Bob&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="sr">/text\/html/</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&lt;h1&gt;Hello, Bob!&lt;/h1&gt;&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="websocket">WebSocket<a class="headerlink" href="#websocket" title="Permanent link">&para;</a></h4>
<ul>
<li>WebSocketæ˜¯ HTML5 æ–°å¢çš„åè®®ï¼Œå®ƒçš„ç›®çš„æ˜¯åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªä¸å—é™çš„åŒå‘é€šä¿¡çš„é€šé“ï¼Œæ¯”å¦‚è¯´ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å‘é€æ¶ˆæ¯ç»™æµè§ˆå™¨ã€‚<ul>
<li>HTTPåè®®æ˜¯ä¸€ä¸ªè¯·æ±‚ï¼å“åº”åè®®ï¼Œè¯·æ±‚å¿…é¡»å…ˆç”±æµè§ˆå™¨å‘ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ‰èƒ½å“åº”è¿™ä¸ªè¯·æ±‚ï¼Œå†æŠŠæ•°æ®å‘é€ç»™æµè§ˆå™¨ã€‚æ¢å¥è¯è¯´ï¼Œæµè§ˆå™¨ä¸ä¸»åŠ¨è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ˜¯æ²¡æ³•ä¸»åŠ¨å‘æ•°æ®ç»™æµè§ˆå™¨çš„ã€‚</li>
</ul>
</li>
<li>ä¹Ÿèƒ½å®ç°, ä½†æ˜¯æ•ˆç‡ä½. æ¯”å¦‚ç”¨è½®è¯¢æˆ–è€…Cometã€‚<ul>
<li>è½®è¯¢æ˜¯æŒ‡æµè§ˆå™¨é€šè¿‡JavaScriptå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç„¶åä»¥å›ºå®šçš„é—´éš”ç»™æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°æ¶ˆæ¯ã€‚è¿™ä¸ªæœºåˆ¶çš„ç¼ºç‚¹ä¸€æ˜¯å®æ—¶æ€§ä¸å¤Ÿï¼ŒäºŒæ˜¯é¢‘ç¹çš„è¯·æ±‚ä¼šç»™æœåŠ¡å™¨å¸¦æ¥æå¤§çš„å‹åŠ›ã€‚</li>
<li>Cometæœ¬è´¨ä¸Šä¹Ÿæ˜¯è½®è¯¢ï¼Œä½†æ˜¯åœ¨æ²¡æœ‰æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å…ˆæ‹–ä¸€æ®µæ—¶é—´ï¼Œç­‰åˆ°æœ‰æ¶ˆæ¯äº†å†å›å¤ã€‚è¿™ä¸ªæœºåˆ¶æš‚æ—¶åœ°è§£å†³äº†å®æ—¶æ€§é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼šä»¥å¤šçº¿ç¨‹æ¨¡å¼è¿è¡Œçš„æœåŠ¡å™¨ä¼šè®©å¤§éƒ¨åˆ†çº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œæå¤§åœ°æµªè´¹æœåŠ¡å™¨èµ„æºã€‚å¦å¤–ï¼Œä¸€ä¸ªHTTPè¿æ¥åœ¨é•¿æ—¶é—´æ²¡æœ‰æ•°æ®ä¼ è¾“çš„æƒ…å†µä¸‹ï¼Œé“¾è·¯ä¸Šçš„ä»»ä½•ä¸€ä¸ªç½‘å…³éƒ½å¯èƒ½å…³é—­è¿™ä¸ªè¿æ¥ï¼Œè€Œç½‘å…³æ˜¯æˆ‘ä»¬ä¸å¯æ§çš„ï¼Œè¿™å°±è¦æ±‚Cometè¿æ¥å¿…é¡»å®šæœŸå‘ä¸€äº›pingæ•°æ®è¡¨ç¤ºè¿æ¥â€œæ­£å¸¸å·¥ä½œâ€ã€‚</li>
</ul>
</li>
<li>ä¸ºä»€ä¹ˆWebSocketè¿æ¥å¯ä»¥å®ç°å…¨åŒå·¥é€šä¿¡è€ŒHTTPè¿æ¥ä¸è¡Œå‘¢ï¼Ÿå®é™…ä¸ŠHTTPåè®®æ˜¯å»ºç«‹åœ¨TCPåè®®ä¹‹ä¸Šçš„ï¼ŒTCPåè®®æœ¬èº«å°±å®ç°äº†å…¨åŒå·¥é€šä¿¡ï¼Œä½†æ˜¯HTTPåè®®çš„è¯·æ±‚ï¼åº”ç­”æœºåˆ¶é™åˆ¶äº†å…¨åŒå·¥é€šä¿¡ã€‚WebSocketè¿æ¥å»ºç«‹ä»¥åï¼Œå…¶å®åªæ˜¯ç®€å•è§„å®šäº†ä¸€ä¸‹ï¼šæ¥ä¸‹æ¥ï¼Œå’±ä»¬é€šä¿¡å°±ä¸ä½¿ç”¨HTTPåè®®äº†ï¼Œç›´æ¥äº’ç›¸å‘æ•°æ®å§ã€‚<ul>
<li>å®‰å…¨çš„WebSocketè¿æ¥æœºåˆ¶å’ŒHTTPSç±»ä¼¼ã€‚é¦–å…ˆï¼Œæµè§ˆå™¨ç”¨<code>wss://xxx</code>åˆ›å»ºWebSocketè¿æ¥æ—¶ï¼Œä¼šå…ˆé€šè¿‡HTTPSåˆ›å»ºå®‰å…¨çš„è¿æ¥ï¼Œç„¶åï¼Œè¯¥HTTPSè¿æ¥å‡çº§ä¸ºWebSocketè¿æ¥ï¼Œåº•å±‚é€šä¿¡èµ°çš„ä»ç„¶æ˜¯å®‰å…¨çš„SSL/TLSåè®®ã€‚</li>
</ul>
</li>
<li>æœåŠ¡å™¨<ul>
<li>ç”±äºWebSocketæ˜¯ä¸€ä¸ªåè®®ï¼ŒæœåŠ¡å™¨å…·ä½“æ€ä¹ˆå®ç°ï¼Œå–å†³äºæ‰€ç”¨ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶æœ¬èº«ã€‚Node.jsæœ¬èº«æ”¯æŒçš„åè®®åŒ…æ‹¬TCPåè®®å’ŒHTTPåè®®ï¼Œè¦æ”¯æŒWebSocketåè®®ï¼Œéœ€è¦å¯¹Node.jsæä¾›çš„HTTPServeråšé¢å¤–çš„å¼€å‘ã€‚å·²ç»æœ‰è‹¥å¹²åŸºäºNode.jsçš„ç¨³å®šå¯é çš„WebSocketå®ç°ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨npmå®‰è£…ä½¿ç”¨å³å¯ã€‚</li>
</ul>
</li>
</ul>
<h5 id="ws">ws åè®®<a class="headerlink" href="#ws" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="nx">GET</span><span class="w"> </span><span class="nx">ws</span><span class="o">:</span><span class="c1">//localhost:3000/ws/chat HTTP/1.1</span>
<span class="nx">Host</span><span class="o">:</span><span class="w"> </span><span class="nx">localhost</span>
<span class="nx">Upgrade</span><span class="o">:</span><span class="w"> </span><span class="nx">websocket</span>
<span class="nx">Connection</span><span class="o">:</span><span class="w"> </span><span class="nx">Upgrade</span>
<span class="nx">Origin</span><span class="o">:</span><span class="w"> </span><span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">WebSocket</span><span class="o">-</span><span class="nx">Key</span><span class="o">:</span><span class="w"> </span><span class="nx">client</span><span class="o">-</span><span class="nx">random</span><span class="o">-</span><span class="nx">string</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">WebSocket</span><span class="o">-</span><span class="nx">Version</span><span class="o">:</span><span class="w"> </span><span class="mf">13</span>
</code></pre></div>
<p>è¯¥è¯·æ±‚å’Œæ™®é€šçš„HTTPè¯·æ±‚æœ‰å‡ ç‚¹ä¸åŒï¼š</p>
<ol>
<li>GETè¯·æ±‚çš„åœ°å€ä¸æ˜¯ç±»ä¼¼<code>/path/</code>ï¼Œè€Œæ˜¯ä»¥<code>ws://</code>å¼€å¤´çš„åœ°å€ï¼›</li>
<li>è¯·æ±‚å¤´<code>Upgrade: websocket</code>å’Œ<code>Connection: Upgrade</code>è¡¨ç¤ºè¿™ä¸ªè¿æ¥å°†è¦è¢«è½¬æ¢ä¸ºWebSocketè¿æ¥ï¼›</li>
<li><code>Sec-WebSocket-Key</code>æ˜¯ç”¨äºæ ‡è¯†è¿™ä¸ªè¿æ¥ï¼Œå¹¶éç”¨äºåŠ å¯†æ•°æ®ï¼›</li>
<li><code>Sec-WebSocket-Version</code>æŒ‡å®šäº†WebSocketçš„åè®®ç‰ˆæœ¬ã€‚</li>
</ol>
<p>æœåŠ¡å™¨çš„å“åº”:</p>
<div class="highlight"><pre><span></span><code><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span><span class="w"> </span><span class="mf">101</span><span class="w"> </span><span class="nx">Switching</span><span class="w"> </span><span class="nx">Protocols</span>
<span class="nx">Upgrade</span><span class="o">:</span><span class="w"> </span><span class="nx">websocket</span>
<span class="nx">Connection</span><span class="o">:</span><span class="w"> </span><span class="nx">Upgrade</span>
<span class="nx">Sec</span><span class="o">-</span><span class="nx">WebSocket</span><span class="o">-</span><span class="nx">Accept</span><span class="o">:</span><span class="w"> </span><span class="nx">server</span><span class="o">-</span><span class="nx">random</span><span class="o">-</span><span class="nx">string</span>
</code></pre></div>
<p>è¯¥å“åº”ä»£ç <code>101</code>è¡¨ç¤ºæœ¬æ¬¡è¿æ¥çš„HTTPåè®®å³å°†è¢«æ›´æ”¹ï¼Œæ›´æ”¹åçš„åè®®å°±æ˜¯<code>Upgrade: websocket</code>æŒ‡å®šçš„WebSocketåè®®ã€‚</p>
<h5 id="_10">æ¡ˆä¾‹: ç¼–å†™èŠå¤©å®¤<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h5>
<h5 id="_11">å¦‚ä½•å…±ç”¨ç«¯å£<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h5>
<p>koaé€šè¿‡3000ç«¯å£å“åº”HTTPï¼Œæˆ‘ä»¬è¦æ–°åŠ çš„WebSocketServerè¿˜èƒ½å¦ä½¿ç”¨3000ç«¯å£ï¼Ÿå¯ä»¥!</p>
<ul>
<li>å®é™…ä¸Šï¼Œ3000ç«¯å£å¹¶éç”±koaç›‘å¬ï¼Œè€Œæ˜¯koaè°ƒç”¨Nodeæ ‡å‡†çš„httpæ¨¡å—åˆ›å»ºçš„http.Serverç›‘å¬çš„ã€‚koaåªæ˜¯æŠŠå“åº”å‡½æ•°æ³¨å†Œåˆ°è¯¥http.Serverä¸­äº†ã€‚ç±»ä¼¼çš„ï¼ŒWebSocketServerä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„å“åº”å‡½æ•°æ³¨å†Œåˆ°http.Serverä¸­ï¼Œè¿™æ ·ï¼ŒåŒä¸€ä¸ªç«¯å£ï¼Œæ ¹æ®åè®®ï¼Œå¯ä»¥åˆ†åˆ«ç”±koaå’Œwså¤„ç†</li>
<li>æŠŠWebSocketServerç»‘å®šåˆ°åŒä¸€ä¸ªç«¯å£çš„å…³é”®ä»£ç æ˜¯å…ˆè·å–koaåˆ›å»ºçš„<code>http.Server</code>çš„å¼•ç”¨ï¼Œå†æ ¹æ®<code>http.Server</code>åˆ›å»ºWebSocketServer</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// koa appçš„listen()æ–¹æ³•è¿”å›http.Server:</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºWebSocketServer:</span>
<span class="kd">let</span><span class="w"> </span><span class="nx">wss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocketServer</span><span class="p">({</span>
<span class="w">    </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="nx">server</span>
<span class="p">});</span>
</code></pre></div>
<h6 id="cookie">å¦‚ä½•è¯†åˆ«ç”¨æˆ·èº«ä»½: cookie<a class="headerlink" href="#cookie" title="Permanent link">&para;</a></h6>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>æ€»ç»“: æ€»ä½“è€Œè¨€, cookie æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç›¸äº’é…åˆçš„è¿‡ç¨‹. (ä»¥è¿™ä¸ªæ¡ˆä¾‹ä¸ºå‡†, <code>/singin</code> é¡µé¢è¿›è¡Œç™»é™†, <code>/</code> é¡µé¢ä¸ºèŠå¤©å®¤)</p>
<ol>
<li>æµè§ˆå™¨è¯·æ±‚ <code>/</code>, åˆå§‹çš„æ—¶å€™è¿˜æ²¡æœ‰ cookie, koa è¿›è¡Œåˆ¤æ–­, å°†é¡µé¢é‡å®šå‘åˆ° <code>/signin</code>;</li>
<li>ç”¨æˆ·å¡«å†™èº«ä»½ä¿¡æ¯, å‘é€ post è¯·æ±‚;</li>
<li>æœåŠ¡å™¨ç”Ÿæˆ cookie (ä¸‹é¢çš„ &ldquo;POST /signin&rdquo; å¯¹åº”çš„å‡½æ•°), é‡å®šå‘å› <code>/</code> èŠå¤©é¡µé¢ (è¿™é‡Œä¸è€ƒè™‘ç”¨æˆ·ä¿¡æ¯å‡ºé”™çš„æƒ…å†µ)</li>
<li>æµè§ˆå™¨å†æ¬¡è¯·æ±‚ <code>/</code>, æ­¤æ—¶å‘é€çš„æ˜¯å¸¦æœ‰ cookie çš„, koa éªŒè¯ cookie (åœ¨ middleware ä¸­æ³¨å†Œäº† parseUser å‡½æ•°), æˆåŠŸåæ¸²æŸ“é¡µé¢å‘é€ç»™æµè§ˆå™¨ (&lsquo;GET /&rsquo; å¯¹åº”çš„å‡½æ•°)</li>
<li>åœ¨ <code>/</code> é¡µé¢ä¸­åŒ…å«äº†å»ºç«‹ ws è¿æ¥çš„ä»£ç , æµè§ˆå™¨å‘èµ· ws è¿æ¥è¯·æ±‚ <code>new WebSocket('ws://localhost:3000/ws/chat')</code> (åœ¨ <code>room.html</code> æ¨¡æ¿ä¸­)</li>
<li>æœåŠ¡å™¨éªŒè¯ cookie (åœ¨å“åº” &lsquo;connection&rsquo; çš„æ—¶å€™è°ƒç”¨ parseUser), å»ºç«‹è¿æ¥</li>
<li>ç„¶å, æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å‘é€æ¶ˆæ¯å°±é€šè¿‡è¿™æ¡å»ºç«‹å¥½çš„ ws è¿æ¥æ¥é€šä¿¡äº†!</li>
</ol>
</div>
<ul>
<li>åœ¨koaåº”ç”¨ä¸­ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è®¤è¯ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡sessionæˆ–è€…cookieï¼Œä½†æ˜¯ï¼Œåœ¨å“åº”WebSocketè¯·æ±‚æ—¶ï¼Œå¦‚ä½•è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Ÿ</li>
<li>ä¸€ä¸ªç®€å•å¯è¡Œçš„æ–¹æ¡ˆæ˜¯æŠŠç”¨æˆ·ç™»å½•åçš„èº«ä»½å†™å…¥Cookieï¼Œåœ¨koaä¸­ï¼Œå¯ä»¥ä½¿ç”¨middlewareè§£æCookieï¼ŒæŠŠç”¨æˆ·ç»‘å®šåˆ°<code>ctx.state.user</code>ä¸Šã€‚</li>
<li>WSè¯·æ±‚ä¹Ÿæ˜¯æ ‡å‡†çš„HTTPè¯·æ±‚ï¼Œæ‰€ä»¥ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šæŠŠCookieå‘é€è¿‡æ¥ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ç”¨WebSocketServerå¤„ç†WSè¯·æ±‚æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®Cookieè¯†åˆ«ç”¨æˆ·èº«ä»½ã€‚</li>
<li>å¤„ç†é€»è¾‘<ul>
<li>åœ¨ koa ä¸­, (åœ¨ middleware æ³¨å†Œ parseUser å‡½æ•°), å°† cookie ä¿å­˜åœ¨ <code>ctx.state</code> ä¸­. ç”±äºå¤„ç†çš„éƒ½æ˜¯ http è¯·æ±‚, å¯ä»¥å®¹æ˜“å¾—åˆ°</li>
<li>è€Œå¯¹äº ws, æˆ‘ä»¬éœ€è¦åœ¨åˆå§‹å»ºç«‹ connection çš„æ—¶å€™åˆ›å»º cookie, ç„¶åç»‘å®šåˆ° WebSocketå¯¹è±¡ ä¸Š.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* server æ–°ç”¨æˆ·ç™»é™†, æ„é€  user å¯¹è±¡, ç”Ÿæˆ base64 ç¼–ç çš„ cookie â€”â€” ç„¶åå‘é€ç»™æµè§ˆå™¨</span>
<span class="cm">controller/signin.js */</span>
<span class="w">    </span><span class="s2">&quot;POST /signin&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">index</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;è·¯äººç”²&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span>
<span class="w">            </span><span class="nx">image</span><span class="o">:</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">user</span><span class="p">)).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;base64&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Set cookie value: </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">);</span>
<span class="w">        </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// é‡å®šå‘å›é¦–é¡µ</span>
<span class="w">    </span><span class="p">},</span>
<span class="cm">/* controller/index.js */</span>
<span class="w">    </span><span class="s1">&#39;GET /&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;room.html&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="nx">user</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/signin&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="cm">/* è¯†åˆ«ç”¨æˆ·èº«ä»½çš„é€»è¾‘</span>
<span class="cm">ä¼ å…¥çš„ obj å¯ä»¥æ˜¯ 1. cookie å­—ç¬¦ä¸²; 2. request å¯¹è±¡ */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">parseUser</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;try parse: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">obj</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">obj</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">headers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Cookies</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">        </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;base64&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
<span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`User: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">, ID: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ignore</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// åœ¨koaçš„middlewareä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è¯†åˆ«ç”¨æˆ·</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parseUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// åœ¨WebSocketServerä¸­ï¼Œå°±éœ€è¦å“åº”`connection`äº‹ä»¶ï¼Œç„¶åè¯†åˆ«ç”¨æˆ·</span>
<span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">ws</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ws.upgradeReqæ˜¯ä¸€ä¸ª (http) requestå¯¹è±¡:</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parseUser</span><span class="p">(</span><span class="nx">ws</span><span class="p">.</span><span class="nx">upgradeReq</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Cookieä¸å­˜åœ¨æˆ–æ— æ•ˆï¼Œç›´æ¥å…³é—­WebSocket:</span>
<span class="w">        </span><span class="nx">ws</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mf">4001</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Invalid user&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// è¯†åˆ«æˆåŠŸï¼ŒæŠŠuserç»‘å®šåˆ°è¯¥ WebSocket å¯¹è±¡:</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ç»‘å®šWebSocketServerå¯¹è±¡:</span>
<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">wss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wss</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<p>æµè§ˆå™¨</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* room.html */</span>
<span class="cm">/* åˆå§‹åŒ–é¡µé¢çš„æ—¶å€™, å’ŒæœåŠ¡å™¨å»ºç«‹ ws è¿æ¥, è®¾ç½® onmessage ç›‘å¬é€»è¾‘ */</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://localhost:3000/ws/chat&#39;</span><span class="p">);</span>

<span class="w">    </span><span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;list&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;join&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">addToUserList</span><span class="p">(</span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="w">            </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">removeFromUserList</span><span class="p">(</span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="w">            </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;chat&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="cm">/* æ‹¦æˆªæ¶ˆæ¯å‘é€è¿™ä¸ªè¡¨å• (idä¸º form-chat), ä½¿ç”¨ ws è¿›è¡Œå‘é€æ¶ˆæ¯ */</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form-chat&#39;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[type=text]&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">trim</span><span class="p">();</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[chat] &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</code></pre></div>
<h6 id="_12">èŠå¤©å®¤é€»è¾‘<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h6>
<ul>
<li>æˆ‘ä»¬è¦å¯¹æ¯ä¸ªåˆ›å»ºæˆåŠŸçš„WebSocketç»‘å®š<code>message</code>ã€<code>close</code>ã€<code>error</code>ç­‰äº‹ä»¶å¤„ç†å‡½æ•°ã€‚å¯¹äºèŠå¤©åº”ç”¨æ¥è¯´ï¼Œæ¯æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œå°±éœ€è¦æŠŠè¯¥æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰WebSocketè¿æ¥ä¸Šã€‚</li>
<li>å¤„ç†é€»è¾‘:<ul>
<li>æŸä¸ªWebSocketæ”¶åˆ°æ¶ˆæ¯, å¹¿æ’­åˆ°æ‰€æœ‰è¿æ¥</li>
</ul>
</li>
</ul>
<h6 id="_13">é¡µé¢ç«¯<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h6>
<ul>
<li>èŠå¤©å®¤é¡µé¢å¯ä»¥åˆ’åˆ†ä¸ºå·¦ä¾§ä¼šè¯åˆ—è¡¨å’Œå³ä¾§ç”¨æˆ·åˆ—è¡¨ä¸¤éƒ¨åˆ†</li>
<li>åœ¨èŠå¤©å®¤åº”ç”¨ä¸­, DOMéœ€è¦åŠ¨æ€æ›´æ–°ï¼Œå› æ­¤ï¼ŒçŠ¶æ€ç®¡ç†æ˜¯é¡µé¢é€»è¾‘çš„æ ¸å¿ƒã€‚<ul>
<li>ä¸ºäº†ç®€åŒ–çŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬ç”¨ <code>Vue</code> æ§åˆ¶å·¦å³ä¸¤ä¸ªåˆ—è¡¨</li>
</ul>
</li>
</ul>
<p>ç´§æ¥ç€ï¼Œåˆ›å»ºWebSocketè¿æ¥ï¼Œå“åº”æœåŠ¡å™¨æ¶ˆæ¯ï¼Œå¹¶ä¸”æ›´æ–°ä¼šè¯åˆ—è¡¨å’Œç”¨æˆ·åˆ—è¡¨</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ä¸ºäº†å»ºç«‹ ws è¿æ¥, å‘é€çš„è¿˜æ˜¯ http è¯·æ±‚, </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">ws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s1">&#39;ws://localhost:3000/ws/chat&#39;</span><span class="p">);</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;list&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;join&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">addToUserList</span><span class="p">(</span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="w">        </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">removeFromUserList</span><span class="p">(</span><span class="nx">vmUserList</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="w">        </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;chat&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">addMessage</span><span class="p">(</span><span class="nx">vmMessageList</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h6 id="_14">é…ç½®åå‘ä»£ç†<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h6>
<ul>
<li>å¦‚æœç½‘ç«™é…ç½®äº†åå‘ä»£ç†ï¼Œä¾‹å¦‚Nginxï¼Œåˆ™HTTPå’ŒWebSocketéƒ½å¿…é¡»é€šè¿‡åå‘ä»£ç†è¿æ¥NodeæœåŠ¡å™¨ã€‚<ul>
<li>HTTPçš„åå‘ä»£ç†éå¸¸ç®€å•ï¼Œä½†æ˜¯è¦æ­£å¸¸è¿æ¥WebSocketï¼Œä»£ç†æœåŠ¡å™¨å¿…é¡»æ”¯æŒWebSocketåè®®ã€‚</li>
<li>Nginx ä¸ºä¾‹, å®˜æ–¹åšå®¢ï¼š<a href="https://www.nginx.com/blog/websocket-nginx/">Using NGINX as a WebSocket Proxy</a></li>
</ul>
</li>
</ul>
<h4 id="rest">REST<a class="headerlink" href="#rest" title="Permanent link">&para;</a></h4>
<ul>
<li>è‡ªä»Roy Fieldingåšå£«åœ¨2000å¹´ä»–çš„åšå£«è®ºæ–‡ä¸­æå‡º<a href="http://zh.wikipedia.org/wiki/REST">REST</a>ï¼ˆRepresentational State Transferï¼‰é£æ ¼çš„è½¯ä»¶æ¶æ„æ¨¡å¼åï¼ŒRESTå°±åŸºæœ¬ä¸Šè¿…é€Ÿå–ä»£äº†å¤æ‚è€Œç¬¨é‡çš„SOAPï¼Œæˆä¸ºWeb APIçš„æ ‡å‡†äº†ã€‚</li>
<li>ç¼–å†™APIæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ<ul>
<li>ç”±äºAPIå°±æ˜¯æŠŠWeb Appçš„åŠŸèƒ½å…¨éƒ¨å°è£…äº†ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡APIæ“ä½œæ•°æ®ï¼Œå¯ä»¥æå¤§åœ°æŠŠå‰ç«¯å’Œåç«¯çš„ä»£ç éš”ç¦»ï¼Œä½¿å¾—åç«¯ä»£ç æ˜“äºæµ‹è¯•ï¼Œå‰ç«¯ä»£ç ç¼–å†™æ›´ç®€å•ã€‚</li>
<li>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå‰ç«¯é¡µé¢çœ‹ä½œæ˜¯ä¸€ç§ç”¨äºå±•ç¤ºçš„å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆAPIå°±æ˜¯ä¸ºå®¢æˆ·ç«¯æä¾›æ•°æ®ã€æ“ä½œæ•°æ®çš„æ¥å£ã€‚<ul>
<li><strong>è¿™ç§è®¾è®¡å¯ä»¥è·å¾—æé«˜çš„æ‰©å±•æ€§</strong>ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·éœ€è¦åœ¨æ‰‹æœºä¸Šè´­ä¹°å•†å“æ—¶ï¼Œåªéœ€è¦å¼€å‘é’ˆå¯¹iOSå’ŒAndroidçš„ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œé€šè¿‡å®¢æˆ·ç«¯è®¿é—®APIï¼Œå°±å¯ä»¥å®Œæˆé€šè¿‡æµè§ˆå™¨é¡µé¢æä¾›çš„åŠŸèƒ½ï¼Œè€Œåç«¯ä»£ç åŸºæœ¬æ— éœ€æ”¹åŠ¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="rest-api">ç¼–å†™ REST API<a class="headerlink" href="#rest-api" title="Permanent link">&para;</a></h5>
<ul>
<li>ç¼–å†™REST APIï¼Œå®é™…ä¸Šå°±æ˜¯ç¼–å†™å¤„ç†HTTPè¯·æ±‚çš„asyncå‡½æ•°ï¼Œä¸è¿‡ï¼ŒRESTè¯·æ±‚å’Œæ™®é€šçš„HTTPè¯·æ±‚æœ‰å‡ ä¸ªç‰¹æ®Šçš„åœ°æ–¹ï¼š<ul>
<li>RESTè¯·æ±‚ä»ç„¶æ˜¯æ ‡å‡†çš„HTTPè¯·æ±‚ï¼Œä½†æ˜¯ï¼Œé™¤äº†GETè¯·æ±‚å¤–ï¼ŒPOSTã€PUTç­‰è¯·æ±‚çš„bodyæ˜¯JSONæ•°æ®æ ¼å¼ï¼Œè¯·æ±‚çš„<code>Content-Type</code> ä¸º <code>application/json</code></li>
<li>RESTå“åº”è¿”å›çš„ç»“æœæ˜¯JSONæ•°æ®æ ¼å¼ï¼Œå› æ­¤ï¼Œå“åº”çš„ <code>Content-Type</code>ä¹Ÿæ˜¯<code>application/json</code>ã€‚</li>
</ul>
</li>
<li>RESTè§„èŒƒå®šä¹‰äº†èµ„æºçš„é€šç”¨è®¿é—®æ ¼å¼ï¼Œè™½ç„¶å®ƒä¸æ˜¯ä¸€ä¸ªå¼ºåˆ¶è¦æ±‚ï¼Œä½†éµå®ˆè¯¥è§„èŒƒå¯ä»¥è®©äººæ˜“äºç†è§£ã€‚<ul>
<li>è·å–èµ„æº, ä½¿ç”¨ GET<ul>
<li>èµ„æºè¿˜å¯ä»¥æŒ‰å±‚æ¬¡ç»„ç»‡</li>
<li>å½“æˆ‘ä»¬åªéœ€è¦è·å–éƒ¨åˆ†æ•°æ®æ—¶ï¼Œå¯é€šè¿‡å‚æ•°é™åˆ¶è¿”å›çš„ç»“æœé›†</li>
</ul>
</li>
<li>æ–°å»ºä¸€ä¸ªProductä½¿ç”¨POSTè¯·æ±‚ï¼ŒJSONæ•°æ®åŒ…å«åœ¨bodyä¸­</li>
<li>æ›´æ–°ä¸€ä¸ªProductä½¿ç”¨PUTè¯·æ±‚</li>
<li>åˆ é™¤ä¸€ä¸ªProductä½¿ç”¨DELETEè¯·æ±‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">GET</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="w"> </span><span class="c1">// è·å–æ‰€æœ‰å•†å“</span>
<span class="nx">GET</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="o">/</span><span class="mf">123</span><span class="o">/</span><span class="nx">reviews</span>
<span class="nx">GET</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="o">/</span><span class="mf">123</span><span class="o">/</span><span class="nx">reviews</span><span class="o">?</span><span class="nx">page</span><span class="o">=</span><span class="mf">2</span><span class="o">&amp;</span><span class="nx">size</span><span class="o">=</span><span class="mf">10</span><span class="o">&amp;</span><span class="nx">sort</span><span class="o">=</span><span class="nx">time</span><span class="w"> </span><span class="c1">// è¿”å›ç¬¬2é¡µè¯„è®ºï¼Œæ¯é¡µ10é¡¹ï¼ŒæŒ‰æ—¶é—´æ’åº</span>

<span class="nx">POST</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="w"> </span><span class="c1">// æ–°å»º, JSON æ•°æ®æ”¾åœ¨ bodyä¸­</span>

<span class="nx">PUT</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="o">/</span><span class="mf">123</span><span class="w"> </span><span class="c1">// æ›´æ–°</span>

<span class="nx">DELETE</span><span class="w"> </span><span class="o">/</span><span class="nx">api</span><span class="o">/</span><span class="nx">products</span><span class="o">/</span><span class="mf">123</span>
</code></pre></div>
<p>åœ¨koaä¸­å¤„ç†RESTè¯·æ±‚æ˜¯éå¸¸ç®€å•çš„ã€‚<code>bodyParser()</code>è¿™ä¸ªmiddlewareå¯ä»¥è§£æè¯·æ±‚çš„JSONæ•°æ®å¹¶ç»‘å®šåˆ°<code>ctx.request.body</code>ä¸Šï¼Œè¾“å‡ºJSONæ—¶æˆ‘ä»¬å…ˆæŒ‡å®š<code>ctx.response.type = 'application/json'</code>ï¼Œç„¶åæŠŠJavaScriptå¯¹è±¡èµ‹å€¼ç»™<code>ctx.response.body</code>å°±å®Œæˆäº†RESTè¯·æ±‚çš„å¤„ç†ã€‚</p>
<h5 id="rest-api_1">å¼€å‘ REST API<a class="headerlink" href="#rest-api_1" title="Permanent link">&para;</a></h5>
<ul>
<li>ä½¿ç”¨RESTè™½ç„¶éå¸¸ç®€å•ï¼Œä½†æ˜¯ï¼Œè®¾è®¡ä¸€å¥—åˆç†çš„RESTæ¡†æ¶å´éœ€è¦ä»”ç»†è€ƒè™‘å¾ˆå¤šé—®é¢˜ã€‚</li>
<li>é—®é¢˜ä¸€ï¼šå¦‚ä½•ç»„ç»‡URL<ul>
<li>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªWebåº”ç”¨æ—¢æœ‰RESTï¼Œè¿˜æœ‰MVCï¼Œå¯èƒ½è¿˜éœ€è¦é›†æˆå…¶ä»–ç¬¬ä¸‰æ–¹ç³»ç»Ÿã€‚å¦‚ä½•ç»„ç»‡URLï¼Ÿ</li>
<li>ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡å›ºå®šçš„å‰ç¼€åŒºåˆ†ã€‚ä¾‹å¦‚ï¼Œ<code>/static/</code>å¼€å¤´çš„URLæ˜¯é™æ€èµ„æºæ–‡ä»¶ï¼Œç±»ä¼¼çš„ï¼Œ<code>/api/</code>å¼€å¤´çš„URLå°±æ˜¯REST APIï¼Œå…¶ä»–URLæ˜¯æ™®é€šçš„MVCè¯·æ±‚ã€‚</li>
</ul>
</li>
<li>é—®é¢˜äºŒï¼šå¦‚ä½•ç»Ÿä¸€è¾“å‡ºREST<ul>
<li>æ³¨æ„åˆ°, æœåŠ¡ç«¯æ¯æ¬¡è¿”å›çš„éƒ½æ˜¯ä¸€ä¸ª json å†…å®¹, éœ€è¦å›ºå®šè®¾ç½® <code>ctx.response.type = 'application/json';</code></li>
<li>å›å¿†æˆ‘ä»¬é›†æˆNunjucksæ¨¡æ¿å¼•æ“çš„æ–¹æ³•ï¼šé€šè¿‡ä¸€ä¸ªmiddlewareç»™<code>ctx</code>æ·»åŠ ä¸€ä¸ª<code>render()</code>æ–¹æ³•ï¼ŒControllerå°±å¯ä»¥ç›´æ¥ä½¿ç”¨<code>ctx.render('view', model)</code>æ¥æ¸²æŸ“æ¨¡æ¿ï¼Œä¸å¿…ç¼–å†™é‡å¤çš„ä»£ç ã€‚</li>
<li>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªmiddlewareç»™<code>ctx</code>æ·»åŠ ä¸€ä¸ª<code>rest()</code>æ–¹æ³•</li>
</ul>
</li>
<li>é—®é¢˜ä¸‰ï¼šå¦‚ä½•å¤„ç†é”™è¯¯<ul>
<li>ç¬¬ä¸€ï¼Œå½“REST APIè¯·æ±‚å‡ºé”™æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å›é”™è¯¯ä¿¡æ¯ï¼Ÿ<ul>
<li>ç±»ä¼¼403ï¼Œ404ï¼Œ500ç­‰é”™è¯¯ï¼Œè¿™äº›é”™è¯¯å®é™…ä¸Šæ˜¯HTTPè¯·æ±‚å¯èƒ½å‘ç”Ÿçš„é”™è¯¯. æœåŠ¡ç«¯ä¸ç”¨ç®¡</li>
</ul>
</li>
<li>ç¬¬äºŒï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°RESTå“åº”åï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯æˆåŠŸè¿˜æ˜¯é”™è¯¯ï¼Ÿ<ul>
<li>è¿”å›é”™è¯¯ä¿¡æ¯, ä¸€ä¸ªJSONå­—ç¬¦ä¸²</li>
</ul>
</li>
</ul>
</li>
<li>é—®é¢˜å››ï¼šå¦‚ä½•å®šä¹‰é”™è¯¯ç <ul>
<li>ç›¸è¾ƒäºç”¨æ•°å­—, ä¸å¦‚ç›´æ¥ç”¨å­—ç¬¦ä¸², å³è®¾å®š <code>"code": "é”™è¯¯ä»£ç ",</code> å’Œ <code>"message": "é”™è¯¯æè¿°ä¿¡æ¯"</code></li>
<li>ä¾‹å¦‚, ä¸€ä¸ªé”™è¯¯ä»£ç å¯ä»¥æ˜¯ <code>auth:bad_password</code></li>
</ul>
</li>
<li>é—®é¢˜äº”ï¼šå¦‚ä½•è¿”å›é”™è¯¯<ul>
<li>ä¸€ä¸ªç›´è§‚çš„æƒ³æ³•æ˜¯ (åœ¨æ§åˆ¶æµç¨‹çš„å„ä¸ªéƒ¨åˆ†) è°ƒç”¨<code>ctx.rest()</code></li>
<li>æ›´å¥½çš„æ–¹å¼æ˜¯å¼‚æ­¥å‡½æ•°ç›´æ¥ç”¨<code>throw</code>è¯­å¥æŠ›å‡ºé”™è¯¯ï¼Œè®©middlewareå»å¤„ç†é”™è¯¯</li>
<li>ä¸‹é¢å®ç°ä¸€ä¸ª restify ä¸­é—´å±‚: ä»…ä»…å¤„ç†å‰ç¼€ä¸º <code>/api/</code> çš„è¯·æ±‚, å¯¹äºå…¶ä»–è¯·æ±‚ç›´æ¥ next<ul>
<li>ç»‘å®š <code>ctx.rest()</code> æ–¹æ³• (é—®é¢˜äºŒï¼šå¦‚ä½•ç»Ÿä¸€è¾“å‡ºREST)</li>
<li>ç”¨ <code>try...catch</code> ç»Ÿä¸€å¤„ç†é”™è¯¯ (åœ¨ controller éƒ¨åˆ†ç›´æ¥æŠ›å‡ºé”™è¯¯å³å¯).</li>
<li>å—ç›Šäºasync/awaitè¯­æ³•ï¼Œæˆ‘ä»¬åœ¨middlewareä¸­å¯ä»¥ç›´æ¥ç”¨<code>try...catch</code>æ•è·å¼‚å¸¸ã€‚å¦‚æœæ˜¯callbackæ¨¡å¼ï¼Œå°±æ— æ³•ç”¨<code>try...catch</code>æ•è·ï¼Œä»£ç ç»“æ„å°†æ··ä¹±å¾—å¤šã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">APIError</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;internal:unknown_error&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">restify</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">pathPrefix</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// REST APIå‰ç¼€ï¼Œé»˜è®¤ä¸º/api/:</span>
<span class="w">        </span><span class="nx">pathPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pathPrefix</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;/api/&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ˜¯å¦æ˜¯REST APIå‰ç¼€?</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">pathPrefix</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// ç»‘å®šrest()æ–¹æ³•:</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<span class="w">                    </span><span class="sb">`Process API </span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">...`</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">                </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">rest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Process API error...&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">code</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;internal:unknown_error&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">};</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// è¿™é‡Œä»…å¤„ç† /api å¼€å¤´çš„è¯·æ±‚, å¯¹äºå…¶ä»–çš„è¯·æ±‚, ç›´æ¥ next è·³è¿‡</span>
<span class="w">                </span><span class="k">await</span><span class="w"> </span><span class="nx">next</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="mvvm">MVVM<a class="headerlink" href="#mvvm" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel">MVVM</a>æ˜¯Model-View-ViewModelçš„ç¼©å†™ã€‚</li>
<li>ç”¨JavaScriptåœ¨æµè§ˆå™¨ä¸­æ“ä½œHTMLï¼Œç»å†äº†è‹¥å¹²å‘å±•é˜¶æ®µï¼š<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼Œç›´æ¥ç”¨JavaScriptæ“ä½œDOMèŠ‚ç‚¹ï¼Œä½¿ç”¨æµè§ˆå™¨æä¾›çš„åŸç”ŸAPI</li>
<li>ç¬¬äºŒé˜¶æ®µï¼Œç”±äºåŸç”ŸAPIä¸å¥½ç”¨ï¼Œè¿˜è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§ï¼ŒjQueryæ¨ªç©ºå‡ºä¸–</li>
<li>ç¬¬ä¸‰é˜¶æ®µï¼ŒMVCæ¨¡å¼ï¼Œéœ€è¦æœåŠ¡å™¨ç«¯é…åˆï¼ŒJavaScriptå¯ä»¥åœ¨å‰ç«¯ä¿®æ”¹æœåŠ¡å™¨æ¸²æŸ“åçš„æ•°æ®</li>
</ul>
</li>
<li>MVVM çš„æ ¸å¿ƒæ€è·¯: å…³æ³¨Modelçš„å˜åŒ–ï¼Œè®©MVVMæ¡†æ¶å»è‡ªåŠ¨æ›´æ–°DOMçš„çŠ¶æ€ï¼Œä»è€ŒæŠŠå¼€å‘è€…ä»æ“ä½œDOMçš„ç¹çæ­¥éª¤ä¸­è§£è„±å‡ºæ¥ï¼</li>
<li>MVVM<ul>
<li>MVVMæœ€æ—©ç”±å¾®è½¯æå‡ºæ¥ï¼Œå®ƒå€Ÿé‰´äº†æ¡Œé¢åº”ç”¨ç¨‹åºçš„MVCæ€æƒ³ï¼Œåœ¨å‰ç«¯é¡µé¢ä¸­ï¼ŒæŠŠModelç”¨çº¯JavaScriptå¯¹è±¡è¡¨ç¤ºï¼ŒViewè´Ÿè´£æ˜¾ç¤ºï¼Œä¸¤è€…åšåˆ°äº†æœ€å¤§é™åº¦çš„åˆ†ç¦»ã€‚</li>
<li>æŠŠModelå’ŒViewå…³è”èµ·æ¥çš„å°±æ˜¯ViewModelã€‚ViewModelè´Ÿè´£æŠŠModelçš„æ•°æ®åŒæ­¥åˆ°Viewæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿˜è´Ÿè´£æŠŠViewçš„ä¿®æ”¹åŒæ­¥å›Modelã€‚</li>
<li>ViewModelå¦‚ä½•ç¼–å†™ï¼Ÿéœ€è¦ç”¨JavaScriptç¼–å†™ä¸€ä¸ªé€šç”¨çš„ViewModelï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥å¤ç”¨æ•´ä¸ªMVVMæ¨¡å‹äº†ã€‚</li>
</ul>
</li>
<li>å¦‚æœæ˜¯ç”¨jQueryå®ç°ä¿®æ”¹DOMèŠ‚ç‚¹, éœ€è¦å…ˆå®šä½å‡º DOM èŠ‚ç‚¹, ç„¶åä¿®æ”¹å…¶å†…å®¹; ç„¶è€Œ, åœ¨ MVVM ä¸­, æˆ‘ä»¬ä¸å…³å¿ƒDOMç»“æ„, åªå…³å¿ƒæ•°æ®æ˜¯æ€ä¹ˆå­˜å‚¨çš„ â€”â€” ä¾‹å¦‚ä½œä¸º js å¯¹è±¡, å› æ­¤ç›´æ¥åœ¨ä»£ç ä¸­ä¿®æ”¹å¯¹è±¡å€¼å³å¯, DOM åŒæ­¥ä¿®æ”¹!<ul>
<li>ä¾‹å¦‚, å¯¹äº <code>var person = {name: 'Bart'}</code>, æˆ‘ä»¬æŠŠå˜é‡<code>person</code>çœ‹ä½œModelï¼ŒæŠŠHTMLæŸäº›DOMèŠ‚ç‚¹çœ‹ä½œViewï¼Œå¹¶å‡å®šå®ƒä»¬ä¹‹é—´è¢«å…³è”èµ·æ¥äº†ã€‚</li>
<li>é€šè¿‡æ”¹å˜JavaScriptå¯¹è±¡çš„çŠ¶æ€ï¼Œä¼šå¯¼è‡´DOMç»“æ„ä½œå‡ºå¯¹åº”çš„å˜åŒ–</li>
</ul>
</li>
<li>è‘—åçš„ MVVM æ¡†æ¶<ul>
<li><a href="https://angularjs.org/">Angular</a>ï¼šGoogleå‡ºå“ï¼Œåæ°”å¤§ï¼Œä½†æ˜¯å¾ˆéš¾ç”¨ï¼›</li>
<li><a href="http://backbonejs.org/">Backbone.js</a>ï¼šå…¥é—¨éå¸¸å›°éš¾ï¼Œå› ä¸ºè‡ªèº«APIå¤ªå¤šï¼›</li>
<li><a href="http://emberjs.com/">Ember</a>ï¼šä¸€ä¸ªå¤§è€Œå…¨çš„æ¡†æ¶ï¼Œæƒ³å†™ä¸ªHello worldéƒ½å¾ˆå›°éš¾ã€‚</li>
<li>æœ€ä½³é€‰æ‹©æ˜¯<a href="http://weibo.com/p/1005051761511274">å°¤é›¨æºª</a>å¤§ç¥å¼€å‘çš„MVVMæ¡†æ¶ï¼š<a href="http://vuejs.org/">Vue.js</a></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cm">/* ç¬¬ä¸€é˜¶æ®µ */</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">dom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
<span class="nx">dom</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Homer&#39;</span><span class="p">;</span>
<span class="nx">dom</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">;</span>

<span class="cm">/* ç¬¬äºŒé˜¶æ®µ */</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#name&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Homer&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</code></pre></div>
<h5 id="vue">Vue å•å‘ç»‘å®š<a class="headerlink" href="#vue" title="Permanent link">&para;</a></h5>
<ul>
<li>åœ¨Vueä¸­ï¼Œå¯ä»¥ç›´æ¥å†™<code>{{ name }}</code>ç»‘å®šæŸä¸ªå±æ€§ã€‚å¦‚æœå±æ€§å…³è”çš„æ˜¯å¯¹è±¡ï¼Œè¿˜å¯ä»¥ç”¨å¤šä¸ª<code>.</code>å¼•ç”¨ï¼Œä¾‹å¦‚ï¼Œ<code>{{ address.zipcode }}</code>ã€‚</li>
<li>å¦ä¸€ç§æ˜¯æŠŠæŒ‡ä»¤å†™åœ¨HTMLèŠ‚ç‚¹çš„å±æ€§ä¸Šï¼Œå®ƒä¼šè¢«Vueè§£æï¼Œè¯¥èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ä¼šè¢«ç»‘å®šä¸ºModelçš„æŒ‡å®šå±æ€§ï¼Œæ³¨æ„ä¸èƒ½å†å†™åŒèŠ±æ‹¬å·<code>{{ }}</code>ã€‚<ul>
<li><code>&lt;p&gt;Hello, &lt;span v-text="name"&gt;&lt;/span&gt;!&lt;/p&gt;</code></li>
</ul>
</li>
</ul>
<p>è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨ <code>&lt;head&gt;</code> å†…éƒ¨ç¼–å†™çš„JavaScriptä»£ç ï¼Œéœ€è¦ç”¨jQueryæŠŠMVVMçš„åˆå§‹åŒ–ä»£ç æ¨è¿Ÿåˆ°é¡µé¢åŠ è½½å®Œæ¯•åæ‰§è¡Œï¼Œå¦åˆ™ï¼Œç›´æ¥åœ¨ <code>&lt;head&gt;</code> å†…æ‰§è¡ŒMVVMä»£ç æ—¶ï¼ŒDOMèŠ‚ç‚¹å°šæœªè¢«æµè§ˆå™¨åŠ è½½ï¼Œåˆå§‹åŒ–å°†å¤±è´¥ã€‚</p>
<p>æ¥çœ‹åˆ›å»ºä¸€ä¸ª VM çš„æ ¸å¿ƒä»£ç :</p>
<ul>
<li><code>el</code> æŒ‡å®šäº†è¦æŠŠModelç»‘å®šåˆ°å“ªä¸ªDOMæ ¹èŠ‚ç‚¹ä¸Šï¼Œè¯­æ³•å’ŒjQueryç±»ä¼¼ã€‚è¿™é‡Œçš„<code>'#vm'</code>å¯¹åº”IDä¸º<code>vm</code>çš„ä¸€ä¸ª<code>&lt;div&gt;</code>èŠ‚ç‚¹<ul>
<li>åœ¨è¯¥èŠ‚ç‚¹ä»¥åŠè¯¥èŠ‚ç‚¹å†…éƒ¨ï¼Œå°±æ˜¯Vueå¯ä»¥æ“ä½œçš„Viewã€‚Vueå¯ä»¥è‡ªåŠ¨æŠŠModelçš„çŠ¶æ€æ˜ å°„åˆ°Viewä¸Šï¼Œä½†æ˜¯ä¸èƒ½æ“ä½œViewèŒƒå›´ä¹‹å¤–çš„å…¶ä»–DOMèŠ‚ç‚¹ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="c">&lt;!--</span><span class="w"> </span><span class="nx">å¼•ç”¨jQuery</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/static/js/jquery.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="c">&lt;!--</span><span class="w"> </span><span class="nx">å¼•ç”¨Vue</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;/static/js/vue.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="c1">// åˆå§‹åŒ–ä»£ç :</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vue</span><span class="p">({</span>
<span class="w">        </span><span class="nx">el</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#vm&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Robot&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="mf">15</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vm</span><span class="p">;</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>

<span class="o">&lt;</span><span class="err">/head&gt;</span>

<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}}</span><span class="o">!&lt;</span><span class="err">/p&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="nx">years</span><span class="w"> </span><span class="nx">old</span><span class="o">!&lt;</span><span class="err">/p&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</code></pre></div>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªè§£æç”¨æˆ·è¾“å…¥, æ‰§è¡Œå‘½ä»¤çš„ä»£ç :</p>
<ul>
<li>ç”¨ jQuery å¾—åˆ°è¾“å…¥å†…å®¹</li>
<li>é€šè¿‡ <code>new Function(...)</code> è§£æä»£ç å­—ç¬¦ä¸²</li>
</ul>
<p>å°†è¯¥å‡½æ•°ç»‘å®šåˆ°é¡µé¢ä¸Šçš„ä¸€ä¸ª button å³å¯.</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">executeJs</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#code&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Function</span><span class="p">(</span><span class="s1">&#39;var vm = window.vm;\n&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">code</span><span class="p">);</span>
<span class="w">        </span><span class="nx">fn</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="vue_1">Vue åŒå‘ç»‘å®š<a class="headerlink" href="#vue_1" title="Permanent link">&para;</a></h5>
<ul>
<li>åŒå‘ç»‘å®š, å³ç”¨æˆ·æ›´æ–°äº†Viewï¼ŒModelçš„æ•°æ®ä¹Ÿè‡ªåŠ¨è¢«æ›´æ–°</li>
<li>ä»€ä¹ˆæƒ…å†µä¸‹ç”¨æˆ·å¯ä»¥æ›´æ–°Viewå‘¢ï¼Ÿå¡«å†™è¡¨å•å°±æ˜¯ä¸€ä¸ªæœ€ç›´æ¥çš„ä¾‹å­ã€‚å½“ç”¨æˆ·å¡«å†™è¡¨å•æ—¶ï¼ŒViewçš„çŠ¶æ€å°±è¢«æ›´æ–°äº†ï¼Œå¦‚æœæ­¤æ—¶MVVMæ¡†æ¶å¯ä»¥è‡ªåŠ¨æ›´æ–°Modelçš„çŠ¶æ€ï¼Œé‚£å°±ç›¸å½“äºæˆ‘ä»¬æŠŠModelå’ŒViewåšäº†åŒå‘ç»‘å®š</li>
<li>åŒå‘ç»‘å®šæœ€å¤§çš„å¥½å¤„æ˜¯æˆ‘ä»¬ä¸å†éœ€è¦ç”¨jQueryå»æŸ¥è¯¢è¡¨å•çš„çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è·å¾—äº†ç”¨JavaScriptå¯¹è±¡è¡¨ç¤ºçš„Modelã€‚</li>
</ul>
<h6 id="_15">å¤„ç†äº‹ä»¶<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h6>
<ul>
<li>å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œä¼ ç»Ÿçš„åšæ³•æ˜¯å“åº”<code>onsubmit</code>äº‹ä»¶ï¼Œç”¨jQueryè·å–è¡¨å•å†…å®¹ï¼Œæ£€æŸ¥è¾“å…¥æ˜¯å¦æœ‰æ•ˆï¼Œæœ€åæäº¤è¡¨å•ï¼Œæˆ–è€…ç”¨AJAXæäº¤è¡¨å•ã€‚</li>
<li>ç°åœ¨ï¼Œè·å–è¡¨å•å†…å®¹å·²ç»ä¸éœ€è¦äº†ï¼Œå› ä¸ºåŒå‘ç»‘å®šç›´æ¥è®©æˆ‘ä»¬è·å¾—äº†è¡¨å•å†…å®¹ï¼Œå¹¶ä¸”è·å¾—äº†åˆé€‚çš„æ•°æ®ç±»å‹ã€‚</li>
<li>å“åº”<code>onsubmit</code>äº‹ä»¶ä¹Ÿå¯ä»¥æ”¾åˆ°VMä¸­ã€‚æˆ‘ä»¬åœ¨<code>&lt;form&gt;</code>å…ƒç´ ä¸Šä½¿ç”¨æŒ‡ä»¤<ul>
<li><code>&lt;form id="vm" v-on:submit.prevent="register"&gt;</code></li>
<li>å…¶ä¸­ï¼Œ<code>v-on:submit="register"</code>æŒ‡ä»¤å°±ä¼šè‡ªåŠ¨ç›‘å¬è¡¨å•çš„<code>submit</code>äº‹ä»¶ï¼Œå¹¶è°ƒç”¨<code>register</code>æ–¹æ³•å¤„ç†è¯¥äº‹ä»¶ã€‚ä½¿ç”¨<code>.prevent</code>è¡¨ç¤ºé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œè¿™æ ·ï¼Œæµè§ˆå™¨ä¸å†å¤„ç†<code>&lt;form&gt;</code>çš„<code>submit</code>äº‹ä»¶ã€‚<ul>
<li>è¡¥å……: 1ã€preventæ˜¯preventDefault,é˜»æ­¢æ ‡ç­¾é»˜è®¤è¡Œä¸ºï¼Œæœ‰äº›æ ‡ç­¾æœ‰é»˜è®¤è¡Œä¸ºï¼Œä¾‹å¦‚aæ ‡ç­¾çš„è·³è½¬é“¾æ¥å±æ€§hrefç­‰ã€‚ 2ã€submitç‚¹å‡»é»˜è®¤è¡Œä¸ºæ˜¯æäº¤è¡¨å•ï¼Œè¿™é‡Œå¹¶ä¸éœ€è¦å®ƒæäº¤ï¼Œåªéœ€è¦æ‰§è¡Œregisteræ–¹æ³•ï¼Œæ•…é˜»æ­¢ä¸ºå¦™ã€‚ 3ã€stopæ˜¯stopPropagationï¼Œé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œç‚¹å‡»å“ªä¸ªå…ƒç´ ï¼Œå°±åªå“åº”è¿™ä¸ªå…ƒç´ ï¼Œçˆ¶çº§å°±ä¸ä¼šå“åº”äº†</li>
</ul>
</li>
<li>å› ä¸ºæˆ‘ä»¬æŒ‡å®šäº†äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯<code>register</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆ›å»ºVMæ—¶æ·»åŠ ä¸€ä¸ª<code>register</code>å‡½æ•°<ul>
<li>åœ¨<code>register()</code>å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨AJAXæŠŠJSONæ ¼å¼çš„Modelå‘é€ç»™æœåŠ¡å™¨ï¼Œå°±å®Œæˆäº†ç”¨æˆ·æ³¨å†Œçš„åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// åœ¨ VM ä¸­å®šä¹‰çš„ register å‡½æ•°</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vue</span><span class="p">({</span>
<span class="w">    </span><span class="nx">el</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#vm&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">register</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// æ˜¾ç¤ºJSONæ ¼å¼çš„Model:</span>
<span class="w">            </span><span class="nx">alert</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$data</span><span class="p">));</span>
<span class="w">            </span><span class="c1">// AJAX POST...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="dom-v-for">åŒæ­¥DOMç»“æ„: v-for<a class="headerlink" href="#dom-v-for" title="Permanent link">&para;</a></h5>
<ul>
<li>é™¤äº†ç®€å•çš„å•å‘ç»‘å®šå’ŒåŒå‘ç»‘å®šï¼ŒMVVMè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç”¨é€”ï¼Œå°±æ˜¯è®©Modelå’ŒDOMçš„ç»“æ„ä¿æŒåŒæ­¥ã€‚</li>
<li><code>v-for</code>æŒ‡ä»¤æŠŠæ•°ç»„å’Œä¸€ç»„<code>&lt;li&gt;</code>å…ƒç´ ç»‘å®šäº†ã€‚åœ¨<code>&lt;li&gt;</code>å…ƒç´ å†…éƒ¨ï¼Œç”¨å¾ªç¯å˜é‡<code>t</code>å¼•ç”¨æŸä¸ªå±æ€§ï¼Œä¾‹å¦‚ï¼Œ<code>{{ t.name }}</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¦‚ä½•æ›´æ–°Modelï¼Œä¸å…³å¿ƒå¦‚ä½•å¢åˆ DOMèŠ‚ç‚¹ï¼Œå¤§å¤§ç®€åŒ–äº†æ•´ä¸ªé¡µé¢çš„é€»è¾‘ã€‚</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒVueä¹‹æ‰€ä»¥èƒ½å¤Ÿç›‘å¬ModelçŠ¶æ€çš„å˜åŒ–ï¼Œæ˜¯å› ä¸ºJavaScriptè¯­è¨€æœ¬èº«æä¾›äº†<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>æˆ–è€…<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe">Object.observe()</a>æœºåˆ¶æ¥ç›‘å¬å¯¹è±¡çŠ¶æ€çš„å˜åŒ–ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ•°ç»„å…ƒç´ çš„èµ‹å€¼ï¼Œå´æ²¡æœ‰åŠæ³•ç›´æ¥ç›‘å¬<ul>
<li><code>vm.todos[0] = {}</code> è¿™æ ·çš„èµ‹å€¼æ— æ³•è¢«ç›‘å¬/åŒæ­¥ä¿®æ”¹, Vueæ— æ³•æ›´æ–°View</li>
<li>è€Œåº”è¯¥è¿™æ ·ä¿®æ”¹ <code>vm.todos[0].name = 'New name';</code></li>
<li>æˆ–è€…ï¼Œé€šè¿‡<code>splice()</code>æ–¹æ³•ï¼Œåˆ é™¤æŸä¸ªå…ƒç´ åï¼Œå†æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¾¾åˆ°â€œèµ‹å€¼â€çš„æ•ˆæœ<ul>
<li><code>vm.todos.splice(index, 1, {});</code></li>
<li>Vueå¯ä»¥ç›‘å¬æ•°ç»„çš„ <code>splice</code>ã€<code>push</code>ã€<code>unshift</code> ç­‰æ–¹æ³•è°ƒç”¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="api">é›†æˆ API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h5>
<ul>
<li>ä¸Šä¸€èŠ‚ä¸­çš„ TODO ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨, æˆ‘ä»¬éœ€è¦è·ŸæœåŠ¡ç«¯åŒæ­¥.</li>
<li>å¦‚æœè¦æŠŠè¿™ä¸ªç®€å•çš„TODOåº”ç”¨å˜æˆä¸€ä¸ªç”¨æˆ·èƒ½ä½¿ç”¨çš„Webåº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š
  1. ç”¨æˆ·çš„TODOæ•°æ®åº”è¯¥ä»åå°è¯»å–ï¼›
  2. å¯¹TODOçš„å¢åˆ æ”¹å¿…é¡»åŒæ­¥åˆ°æœåŠ¡å™¨åç«¯ï¼›
  3. ç”¨æˆ·åœ¨Viewä¸Šå¿…é¡»èƒ½å¤Ÿä¿®æ”¹TODOã€‚</li>
<li>ç¬¬1ä¸ªå’Œç¬¬2ä¸ªé—®é¢˜éƒ½æ˜¯å’ŒAPIç›¸å…³çš„ã€‚åªè¦æˆ‘ä»¬å®ç°äº†åˆé€‚çš„APIæ¥å£ï¼Œå°±å¯ä»¥åœ¨MVVMå†…éƒ¨æ›´æ–°Modelçš„åŒæ—¶ï¼Œé€šè¿‡APIæŠŠæ•°æ®æ›´æ–°åæ˜ åˆ°æœåŠ¡å™¨ç«¯ï¼Œè¿™æ ·ï¼Œç”¨æˆ·æ•°æ®å°±ä¿å­˜åˆ°äº†æœåŠ¡å™¨ç«¯ï¼Œä¸‹æ¬¡æ‰“å¼€é¡µé¢æ—¶å°±å¯ä»¥è¯»å–TODOåˆ—è¡¨ã€‚<ul>
<li>å®ç° API<ul>
<li>GET /api/todosï¼šè¿”å›æ‰€æœ‰TODOåˆ—è¡¨ï¼›</li>
<li>POST /api/todosï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„TODOï¼Œå¹¶è¿”å›åˆ›å»ºåçš„å¯¹è±¡ï¼›</li>
<li>PUT /api/todos/:idï¼šæ›´æ–°ä¸€ä¸ªTODOï¼Œå¹¶è¿”å›æ›´æ–°åçš„å¯¹è±¡ï¼›</li>
<li>DELETE /api/todos/:idï¼šåˆ é™¤ä¸€ä¸ªTODOã€‚</li>
</ul>
</li>
<li>å‡†å¤‡å¥½APIåï¼Œåœ¨Vueä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠModelçš„æ›´æ–° <strong>åŒæ­¥åˆ°æœåŠ¡å™¨ç«¯</strong>ï¼Ÿ<ul>
<li>ä¸€æ˜¯ç›´æ¥ç”¨jQueryçš„AJAXè°ƒç”¨REST APIï¼Œä¸è¿‡è¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦ã€‚</li>
<li>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://github.com/vuejs/vue-resource">vue-resource</a>è¿™ä¸ªé’ˆå¯¹Vueçš„æ‰©å±•ï¼Œå®ƒå¯ä»¥ç»™VMå¯¹è±¡åŠ ä¸Šä¸€ä¸ª<code>$resource</code>å±æ€§ï¼Œé€šè¿‡<code>$resource</code>æ¥æ–¹ä¾¿åœ°æ“ä½œAPIã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å¦‚ä½•å®ç°ä¿®æ”¹?<ul>
<li>ç”¨<code>contenteditable="true"</code> è®©DOMèŠ‚ç‚¹å˜æˆå¯ç¼–è¾‘çš„ï¼Œç”¨<code>v-on:blur="update(t, 'name', $event)"</code>åœ¨ç¼–è¾‘ç»“æŸæ—¶è°ƒç”¨<code>update()</code>æ–¹æ³•å¹¶ä¼ å…¥å‚æ•°ï¼Œç‰¹æ®Šå˜é‡<code>$event</code>è¡¨ç¤ºDOMäº‹ä»¶æœ¬èº«ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="nx">div</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s2">&quot;vm&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="p">{{</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="nx">li</span><span class="w"> </span><span class="nx">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;t in todos&quot;</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="nx">dl</span><span class="o">&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">dt</span><span class="w"> </span><span class="nx">contenteditable</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="nx">v</span><span class="o">-</span><span class="nx">on</span><span class="o">:</span><span class="nx">blur</span><span class="o">=</span><span class="s2">&quot;update(t, &#39;name&#39;, $event)&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/dt&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">dd</span><span class="w"> </span><span class="nx">contenteditable</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="nx">v</span><span class="o">-</span><span class="nx">on</span><span class="o">:</span><span class="nx">blur</span><span class="o">=</span><span class="s2">&quot;update(t, &#39;description&#39;, $event)&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">description</span><span class="w"> </span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/dd&gt;</span>
<span class="w">                </span><span class="o">&lt;</span><span class="nx">dd</span><span class="o">&gt;&lt;</span><span class="nx">a</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#0&quot;</span><span class="w"> </span><span class="nx">v</span><span class="o">-</span><span class="nx">on</span><span class="o">:</span><span class="nx">click</span><span class="o">=</span><span class="s2">&quot;remove(t)&quot;</span><span class="o">&gt;</span><span class="nx">Delete</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/dd</span><span class="o">&gt;</span>
<span class="w">            </span><span class="o">&lt;</span><span class="err">/dl&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="err">/li&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="err">/ol&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</code></pre></div>
<h6 id="vue-resource">vue-resource<a class="headerlink" href="#vue-resource" title="Permanent link">&para;</a></h6>
<p>ä½¿ç”¨: <code>&lt;script src="https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js"&gt;&lt;/script&gt;</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vue</span><span class="p">({</span>
<span class="w">    </span><span class="nx">el</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#vm&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;TODO List&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">todos</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// åˆ›å»ºåæ‰§è¡Œ init å‡½æ•°</span>
<span class="w">    </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">init</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">            </span><span class="nx">that</span><span class="p">.</span><span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/api/todos&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// è°ƒç”¨APIæˆåŠŸæ—¶è°ƒç”¨json()å¼‚æ­¥è¿”å›ç»“æœ:</span>
<span class="w">                </span><span class="nx">resp</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// æ›´æ–°VMçš„todos:</span>
<span class="w">                    </span><span class="nx">that</span><span class="p">.</span><span class="nx">todos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">todos</span><span class="p">;</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// è°ƒç”¨APIå¤±è´¥:</span>
<span class="w">                </span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">        </span><span class="nx">create</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">            </span><span class="nx">that</span><span class="p">.</span><span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/api/todos&#39;</span><span class="p">).</span><span class="nx">save</span><span class="p">(</span><span class="nx">todo</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">resp</span><span class="p">.</span><span class="nx">json</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">that</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="nx">showError</span><span class="p">);</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">update</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">todo</span><span class="p">,</span><span class="w"> </span><span class="nx">prop</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">...</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">remove</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">todo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h5 id="_16">åœ¨çº¿ç”µå­è¡¨æ ¼<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h5>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰Modelçš„ç»“æ„ï¼Œå®ƒçš„ä¸»è¦æ•°æ®å°±æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ¯ä¸ªå•å…ƒæ ¼ç”¨ä¸€ä¸ªJavaScriptå¯¹è±¡è¡¨ç¤º<ul>
<li>å®šä¹‰ç¬¬ä¸€è¡Œ header <code>{ row: 0, col: 0, text: '' },</code></li>
<li>ä»ç¬¬äºŒè¡Œå¼€å§‹ä¸ºæ•°æ® <code>{ row: 1, col: 1, text: '' },</code></li>
<li>è®°å½•å½“å‰æ´»åŠ¨å•å…ƒæ ¼ (<code>selectedRowIndex, selectedColIndex</code>)</li>
</ul>
</li>
<li>ç´§æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠModelçš„ç»“æ„æ˜ å°„åˆ°ä¸€ä¸ª<code>&lt;table&gt;</code>ä¸Š</li>
<li>ç”¨VueæŠŠModelå’ŒViewå…³è”èµ·æ¥ï¼Œè¿™ä¸ªç”µå­è¡¨æ ¼çš„åŸå‹å·²ç»å¯ä»¥è¿è¡Œäº†ï¼</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New Sheet&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">header</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="c1">// å¯¹åº”é¦–è¡Œ A, B, C...</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;B&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;J&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">...</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">...</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">...</span>
<span class="w">         </span><span class="p">{</span><span class="w"> </span><span class="nx">row</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">col</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nx">selectedRowIndex</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// å½“å‰æ´»åŠ¨å•å…ƒæ ¼çš„row</span>
<span class="w">    </span><span class="nx">selectedColIndex</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="c1">// å½“å‰æ´»åŠ¨å•å…ƒæ ¼çš„col</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">table</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;sheet&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;cell in header&quot;</span> <span class="na">v-text</span><span class="o">=</span><span class="s">&quot;cell.text&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;tr in rows&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span> <span class="na">v-for</span><span class="o">=</span><span class="s">&quot;cell in tr&quot;</span> <span class="na">v-text</span><span class="o">=</span><span class="s">&quot;cell.text&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬æƒ³åœ¨å•å…ƒæ ¼å†…è¾“å…¥ä¸€äº›æ–‡æœ¬. éœ€è¦åˆ¤æ–­: é¦–è¡Œå’Œé¦–åˆ—ä¸èƒ½ç¼–è¾‘<ul>
<li>é¦–è¡Œå¯¹åº”çš„æ˜¯<code>&lt;th&gt;</code>ï¼Œé»˜è®¤æ˜¯ä¸å¯ç¼–è¾‘çš„ï¼Œé¦–åˆ—å¯¹åº”çš„æ˜¯ç¬¬ä¸€åˆ—çš„<code>&lt;td&gt;</code>ï¼Œæ‰€ä»¥ï¼Œéœ€è¦åˆ¤æ–­æŸä¸ª<code>&lt;td&gt;</code>æ˜¯å¦å¯ç¼–è¾‘ï¼Œæˆ‘ä»¬ç”¨<code>v-bind</code>æŒ‡ä»¤ç»™æŸä¸ªDOMå…ƒç´ ç»‘å®šå¯¹åº”çš„HTMLå±æ€§</li>
<li>åœ¨Modelä¸­ç»™æ¯ä¸ªå•å…ƒæ ¼å¯¹è±¡åŠ ä¸Š<code>contentEditable</code>å±æ€§ï¼Œå°±å¯ä»¥å†³å®šå“ªäº›å•å…ƒæ ¼å¯ç¼–è¾‘ã€‚</li>
<li><code>&lt;td v-for="cell in tr" v-bind:contenteditable="cell.contentEditable" v-text="cell.text"&gt;&lt;/td&gt;</code></li>
</ul>
</li>
<li>æœ€åï¼Œç»™<code>&lt;td&gt;</code>ç»‘å®šclickäº‹ä»¶ï¼Œè®°å½•å½“å‰æ´»åŠ¨å•å…ƒæ ¼çš„rowå’Œcolï¼Œå†ç»‘å®šbluräº‹ä»¶ï¼Œåœ¨å•å…ƒæ ¼å†…å®¹ç¼–è¾‘ç»“æŸåæ›´æ–°Model<ul>
<li><td v-for="cell in tr" v-on:click="focus(cell)" v-on:blur="change" ...></td></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">vm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Vue</span><span class="p">({</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="nx">methods</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">focus</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">cell</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedRowIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cell</span><span class="p">.</span><span class="nx">row</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedColIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cell</span><span class="p">.</span><span class="nx">col</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">change</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// changeäº‹ä»¶ä¼ å…¥çš„eæ˜¯DOMäº‹ä»¶</span>
<span class="w">            </span><span class="kd">var</span>
<span class="w">                </span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedRowIndex</span><span class="p">,</span>
<span class="w">                </span><span class="nx">colIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">selectedColIndex</span><span class="p">,</span>
<span class="w">                </span><span class="nx">text</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">colIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerText</span><span class="p">;</span><span class="w"> </span><span class="c1">// è·å–tdçš„innerText</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">rowIndex</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">][</span><span class="nx">colIndex</span><span class="p">].</span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<ul>
<li>æ€»ç»“ MVVM é€‚ç”¨èŒƒå›´<ul>
<li>ä»å‡ ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMVVMæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç¼–å†™å‰ç«¯é€»è¾‘éå¸¸å¤æ‚çš„é¡µé¢ï¼Œå°¤å…¶æ˜¯éœ€è¦å¤§é‡DOMæ“ä½œçš„é€»è¾‘ï¼Œåˆ©ç”¨MVVMå¯ä»¥æå¤§åœ°ç®€åŒ–å‰ç«¯é¡µé¢çš„é€»è¾‘ã€‚</li>
<li>å¯¹äºä»¥å±•ç¤ºé€»è¾‘ä¸ºä¸»çš„é¡µé¢ï¼Œä¾‹å¦‚ï¼Œæ–°é—»ï¼Œåšå®¢ã€æ–‡æ¡£ç­‰ï¼Œä¸èƒ½ä½¿ç”¨MVVMå±•ç¤ºæ•°æ®ï¼Œå› ä¸ºè¿™äº›é¡µé¢éœ€è¦è¢«æœç´¢å¼•æ“ç´¢å¼•ï¼Œè€Œæœç´¢å¼•æ“æ— æ³•è·å–ä½¿ç”¨MVVMå¹¶é€šè¿‡APIåŠ è½½çš„æ•°æ®ã€‚</li>
<li>æ‰€ä»¥ï¼Œéœ€è¦SEOï¼ˆSearch Engine Optimizationï¼‰çš„é¡µé¢ï¼Œä¸èƒ½ä½¿ç”¨MVVMå±•ç¤ºæ•°æ®ã€‚ä¸éœ€è¦SEOçš„é¡µé¢ï¼Œå¦‚æœå‰ç«¯é€»è¾‘å¤æ‚ï¼Œå°±é€‚åˆä½¿ç”¨MVVMå±•ç¤ºæ•°æ®ï¼Œä¾‹å¦‚ï¼Œå·¥å…·ç±»é¡µé¢ï¼Œå¤æ‚çš„è¡¨å•é¡µé¢ï¼Œç”¨æˆ·ç™»å½•åæ‰èƒ½æ“ä½œçš„é¡µé¢ç­‰ç­‰ã€‚</li>
</ul>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-2022 Easonshi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Lightblues" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://lightblues.github.io/" target="_blank" rel="noopener" title="lightblues.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1v16.2c0 22.1-17.9 40-40 40h-16c-1.1 0-2.2 0-3.3-.1-1.4.1-2.8.1-4.2.1L416 512h-24c-22.1 0-40-17.9-40-40v-88c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v88c0 22.1-17.9 40-40 40h-55.9c-1.5 0-3-.1-4.5-.2-1.2.1-2.4.2-3.6.2h-16c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9.1-2.8v-69.7h-32c-18 0-32-14-32-32.1 0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7l255.4 224.5c8 7 12 15 11 24z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:oldcitystal@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../js/baidu-tongji.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>